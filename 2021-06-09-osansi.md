---
layout: post
title:  "오산시교통사고위험지역20개소제시"
---
# <font size=6>Content</font><br>
<font size=3>
    
**[1. 초기 설정 및 필요한 코드 작성](#1)**

  * [1.1. 모듈 임포트](#1-1)
      * [1.1.1 기본 모듈 임포트와 초기 설정](#1-1-1)
      * [1.1.2 머신러닝을 위한 모듈 임포트](#1-1-2)
  * [1.2. 함수 생성](#1-2)
      * [1.2.1 공간데이터 삽입 함수](#1-2-1)
      * [1.2.2 격자데이터 삽입 함수](#1-2-2)
  * [1.3. 시각화 이전 작업](#1-3)
  * [1.4. 격자 데이터 분석](#1-4)
    
**[2. 어린이 보호구역 외 어린이 교통사고 위험지역 20개소 제시 ](#2)**

  * [2.1 데이터 전처리](#2-1)
      * [2.1.1 유동인구 데이터](#2-1-1)
      * [2.1.2 어린이인구, 총인구](#2-1-2)
      * [2.1.3 도로 데이터](#2-1-3)
      * [2.1.4 주변 시설](#2-1-4)
      * [2.1.5 교통사고 발생 현황](#2-1-5)
      * [2.1.6 나머지 데이터](#2-1-6)
  * [2.2 70x70 격자로 데이터 병합](#2-2)
      * [2.2.1 교통위험도지수 데이터 병합](#2-2-1)
      * [2.2.2 시설물 데이터 병합](#2-2-2)
  * [2.3. 머신러닝을 활용한 위험도 지수 도출](#2-3)
  * [2.4. 최적화 모델을 활용한 어린이 교통사고 위험지역 도출](#2-4)    
  * [2.5. 어린이 보호구역 외 격자데이터 산출](#2-5)
  * [2.6. MLCP를 통한 20개의 어린이 보호구역 외 교통사고 위험지역 최적화](#2-6)

# <a id=1>1. 초기 설정 및 필요한 코드 작성

# 1.1 모듈 임포트<a id=1-1></a>

## (1) 기본 모듈 임포트와 초기 설정<a id=1-1-1></a>


```python
import warnings
warnings.filterwarnings(action='ignore')
from geoband.API import *
import time
from tqdm import tqdm
from shapely.geometry import Point, shape
from sklearn.preprocessing import MinMaxScaler
import geopandas as gpd
import pandas as pd
import pydeck as pdk
import numpy as np
from numpy import random
import pydeck as pdk
import shapely
from shapely.geometry import Polygon, Point
import matplotlib.pyplot as plt
import seaborn as sns
pd.set_option('display.max_columns', 500)
pd.set_option('display.width', 1000)
```

## (2) 머신러닝을 위한 모듈 임포트<a id=1-1-2></a>


```python
# 머신러닝을 위한 모듈 임포트
from sklearn.model_selection import train_test_split
from sklearn import ensemble
from sklearn.metrics import mean_squared_error
from sklearn.ensemble import RandomForestRegressor
from sklearn.tree import DecisionTreeRegressor
from sklearn.ensemble import GradientBoostingRegressor
from sklearn.neural_network import MLPRegressor
import sklearn.cluster
from sklearn.ensemble import AdaBoostRegressor
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import KFold, GridSearchCV
from sklearn.metrics import r2_score
from sklearn.metrics import mean_squared_error
from sklearn import metrics
from sklearn.model_selection import LeaveOneOut, cross_val_score, KFold
import lightgbm as lgb
import xgboost
import pathlib
from functools import reduce
from collections import defaultdict
from IPython.display import display
import os

import cufflinks as cf 
cf.go_offline(connected=True)
cf.set_config_file(theme='polar')
from mip import Model, xsum, maximize, BINARY  
import jenkspy
```


<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-latest.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



    Using Python-MIP package version 1.5.3
    

# 1-2 함수 생성<a id=1-2></a>

## (1) 공간데이터 처리 함수<a id=1-2-1></a>
- pydeck은 shapely.geometry.도형 형태를 읽지 못하므로 geometry 에 연속된 포인트들을 갖는 리스트 값이 있어야 합니다
- 그러므로 주어진 데이터에 있는 geometry값들을 연속된 포인트들을 갖는 리스트로 바꾸어주어야 합니다
- 이외에도 좌표, 포인트, 폴리곤 등 데이터 형식을 유동적으로 바꿀 수 있도록 하였습니다
- 추가로 필요한 함수들도 언제든 가져다 쓸 수 있도록 미리 만들어 놓았습니다


```python
# 포인트 리스트를 위도, 경도 두가지 컬럼을 가지도록 변환해주는 함수
def 포인트리스트_위도경도(데이터):
    lon=[]
    lat=[]
    for i, v in 데이터.iterrows():
        lon.append(v['좌표값'][0][0])
        lat.append(v['좌표값'][0][1])
    데이터['lon'] = lon
    데이터['lat'] = lat
    return 데이터

# 위도, 경도 두가지 컬럼을 포인트 리스트로 변환해주는 함수
def 위도경도_포인트리스트(데이터):
    리스트좌표 = []
    for i in range(len(데이터)):
        리스트좌표.append([데이터.loc[i, 'lon'],데이터.loc[i, 'lat']])
    데이터['리스트좌표'] = 리스트좌표

# polygon을 리스트 데이터로 변환하는 함수
def 폴리곤_좌표리스트_변환(x): 
    lon, lat = x.exterior.xy 
    return [[x, y] for x, y in zip(lon, lat)]

# multilpolygon을 리스트 데이터로 변환하는 함수
def 멀티폴리곤_좌표리스트_변환(x): 
    lon, lat = x[0].exterior.xy 
    return [[x, y] for x, y in zip(lon, lat)] 

# multilinestring을 리스트 데이터로 변환하는 함수
def 멀티선_좌표리스트_변환(L): 
    if isinstance(L, shapely.geometry.linestring.LineString): 
        lon, lat = L.xy 
        return [[x, y] for x, y in zip(lon, lat)] 
    elif isinstance(L, shapely.geometry.multilinestring.MultiLineString): 
        좌표리스트 = [] 
        for i in range(len(L)): 
            lon, lat = L[i].xy 
            for x, y in zip(lon, lat): 
                좌표리스트.append([x, y])
        return 좌표리스트

# 포인트를 좌표리스트로 변환해주는 함수
def 포인트_좌표리스트_변환(x): 
    lon, lat = x.coords.xy 
    return [[x, y] for x, y in zip(lon, lat)]

# 포인트를 공관좌표로 변환해주는 함수
def 포인트_공간좌표_변환(데이터):
    공간좌표 = []
    for i in range(len(데이터)):
        cent = [[데이터.loc[i,'lon'],데이터.loc[i,'lat']]]
        공간좌표.append(Point(cent[0]))
    데이터['공간좌표'] = 공간좌표
    
# 격자데이터 포인트좌표가 어린이 보호구역 내에 있는지 가려내는 함수
def 격자_어린이보호구역(데이터):
    격자_조밀한격자['어린이보호구역'] = 0
    for i in range(len(데이터)):               
        위치 = 격자_조밀한격자[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*300)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*300)&
                            (데이터.loc[i,'lon']-one_meter*300 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*300 <= 격자데이터['lat'])
                ].index
        격자_조밀한격자.loc[위치,'어린이보호구역'] = 1
```

## (2) 격자데이터 삽입 함수<a id=1-2-2></a>
- 기준 좌표 (격자데이터)에 값을 할당하는 함수를 만들어 어떤 데이터든 할당시킬 수 있도록 하였습니다
- 할당 반경을 미리 설정하여 가져다 쓸 수 있도록 하였습니다
- 할당 시 거리에 따른 가중치를 부여할 수 있는 함수도 만들어 정확도를 높였습니다
- 삽입하려는 데이터의 수가 많으면 코드 진행속도가 오래 걸리므로 얼마나 진행되었는지를 볼 수 있는 기능도 넣었습니다


```python
# 좌표계 기준 1m 미리 설정
one_meter = 0.0000113

def 기준좌표에삽입50(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*50)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*50)&
                            (데이터.loc[i,'lon']-one_meter*50 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*50 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 50m내의 격자포인트에 데이터를 성공적으로 할당하였습니다")

def 기준좌표에삽입100(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*100)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*100)&
                            (데이터.loc[i,'lon']-one_meter*100 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*100 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 100m내의 격자포인트에 데이터를 성공적으로 할당하였습니다")
        
def 기준좌표에삽입150(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*150)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*150)&
                            (데이터.loc[i,'lon']-one_meter*150 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*150 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 150m내의 격자포인트에 데이터를 성공적으로 할당하였습니다")

# 반경을 세 구역으로 나누어 데이터를 할당하는 함수도 만들었습니다
# 더 가까울수록 가중치를 두는 처리가 필요할 수 있기 때문입니다

def 기준좌표에가중치로삽입90(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*90)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*90)&
                            (데이터.loc[i,'lon']-one_meter*90 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*90 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 90m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*60)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*60)&
                            (데이터.loc[i,'lon']-one_meter*60 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*60 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 60m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*30)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*30)&
                            (데이터.loc[i,'lon']-one_meter*30 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*30 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 30m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다")   
    
def 기준좌표에가중치로삽입150(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*150)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*150)&
                            (데이터.loc[i,'lon']-one_meter*150 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*150 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 150m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*100)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*100)&
                            (데이터.loc[i,'lon']-one_meter*100 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*100 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 100m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*50)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*50)&
                            (데이터.loc[i,'lon']-one_meter*50 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*50 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 50m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다")

def 기준좌표에가중치로삽입240(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*240)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*240)&
                            (데이터.loc[i,'lon']-one_meter*240 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*240 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 240m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*160)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*160)&
                            (데이터.loc[i,'lon']-one_meter*160 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*160 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 160m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*80)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*80)&
                            (데이터.loc[i,'lon']-one_meter*80 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*80 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 80m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다")
        
def 기준좌표에가중치로삽입300(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*300)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*300)&
                            (데이터.loc[i,'lon']-one_meter*300 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*300 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 300m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*200)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*200)&
                            (데이터.loc[i,'lon']-one_meter*200 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*200 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 200m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*100)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*100)&
                            (데이터.loc[i,'lon']-one_meter*100 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*100 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 100m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다")
    
def 기준좌표에가중치로삽입450(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*450)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*450)&
                            (데이터.loc[i,'lon']-one_meter*450 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*450 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 450m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*300)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*300)&
                            (데이터.loc[i,'lon']-one_meter*300 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*300 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 300m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*150)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*150)&
                            (데이터.loc[i,'lon']-one_meter*150 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*150 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 150m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다")
    
# 안전시설물을 삽입할 때의 함수를 따로 작성하였습니다
# 반경을 조금 더 넓히고, 가까울수록 가중치를 비교적 많이 부여하기 위함입니다
def 기준좌표에가중치로교통안전시설삽입(데이터):
    격자데이터[데이터.columns[2]] = 0
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*500)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*500)&
                            (데이터.loc[i,'lon']-one_meter*500 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*500 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 500m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*300)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*300)&
                            (데이터.loc[i,'lon']-one_meter*300 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*300 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 300m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다")
    for i in tqdm(range(len(데이터))):               
        위치 = 격자데이터[(격자데이터['lon'] <= 데이터.loc[i,'lon']+one_meter*100)&
                            (격자데이터['lat'] <= 데이터.loc[i,'lat']+one_meter*100)&
                            (데이터.loc[i,'lon']-one_meter*100 <= 격자데이터['lon'])&
                            (데이터.loc[i,'lat']-one_meter*100 <= 격자데이터['lat'])
                ].index
        격자데이터.loc[위치,데이터.columns[2]]+=데이터.loc[i, 데이터.columns[2]]
    print("반경 100m내의 격자포인트에 가중치 5을 두어 데이터를 성공적으로 할당하였습니다")
```

# 1-3 시각화 이전 작업<a id=1-3></a>

#### 데이터 분석 목록
31. 오산시_법정경계(시군구).geojson  
32. 오산시_행정경계(읍면동).geojson  
33. 오산시_법정경계(읍면동).geojson

- 시각화를 할 때마다 지도상에 오산시 경계를 표시하여 효과적으로 시각화를 하고자 합니다  


```python
# 경계 데이터 가져오기
GetCompasData('SBJ_2012_001', '31', '31.오산시_법정경계(시군구).geojson')
GetCompasData('SBJ_2012_001', '32', '32.오산시_행정경계(읍면동).geojson')
GetCompasData('SBJ_2012_001', '33', '33.오산시_법정경계(읍면동).geojson')
# 경계 데이터 입력하기
법정경계_시군구 = gpd.read_file("31.오산시_법정경계(시군구).geojson")
행정경계_읍면동 = gpd.read_file("32.오산시_행정경계(읍면동).geojson")
법정경계_읍면동 = gpd.read_file("33.오산시_법정경계(읍면동).geojson")
```


```python
# 법정경계 데이터를 pydeck에서 처리할 수 있게 변환하였습니다
법정경계_읍면동['좌표값'] = 법정경계_읍면동['geometry'].apply(멀티폴리곤_좌표리스트_변환)
del 법정경계_읍면동['geometry']
법정경계_읍면동 = pd.DataFrame(법정경계_읍면동)
```


```python
# 법정경계 pydeck 레이어를 나중에 가져다 쓸 수 있도록 미리 만들어 놓았습니다
읍면동맵 = pdk.Layer('PolygonLayer', 
                   법정경계_읍면동, 
                   get_polygon='좌표값', 
                   get_fill_color='[50,100,150,30]',
                   get_line_color='[250, 250, 250]',
                   pickable=True, 
                   lineWidthScale=30,
                   auto_highlight=True)

# pydeck을 실행할 때의 View 초기값을 미리 입력하여 나중에 가져다 쓸 수 있도록 하였습니다
center = (37.163,127.054)
zoom = 11.5
view_state = pdk.ViewState(
    longitude=center[1],
    latitude=center[0],
    zoom=zoom)

mmap = pdk.Deck(layers=[읍면동맵],
            mapbox_key = 'pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw',
            initial_view_state=view_state)
mmap.to_html("읍면동맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/읍면동맵.PNG'>

# 1-4 격자 데이터 분석<a id=1-4></a>

#### 격자 데이터 분석 목록

2. 오산시_어린이교통사고_격자.geojson
3. 오산시_차량등록현황_격자.geojson
4. 오산시_연령별_거주인구격자(총인구).geojson
5. 오산시_연령별_거주인구격자(유소년).geojson
6. 오산시_연령별_거주인구격자(생산가능인구).geojson
7. 오산시_연령별_거주인구격자(고령).geojson


- 현재 주어진 격자 데이터는 100x100입니다  
- 과제에 주어진 위험지역 범위설정은 중심점으로부터 반경 50m를 기준으로 합니다   
- 격자 데이터를 세분화 할 필요가 있습니다  
- 그러므로 주어진 격자의 꼭짓점까지 추가좌표로 두어 더 조밀한 데이터들을 모을 필요가 있습니다
- 데이터 형태가 다양하기 때문에 표준 데이터 형태를 포인트로 하여 이후 모든 데이터를 표준화시켰습니다


```python
# 격자 데이터를 넣으면 격자의 꼭짓점 좌표를 추가하여 반환하는 함수를 생성하였습니다
def 격자줄이기(데이터):
    꼭짓점x좌표= []
    꼭짓점y좌표 = []
    꼭짓점값 = []
    중앙x좌표 = []
    중앙y좌표 = []
    중앙값 = []
    for i, v in 데이터.iterrows():
        꼭짓점x좌표.extend([v['geometry'][0].exterior.coords[0][0],v['geometry'][0].exterior.coords[1][0],
                            v['geometry'][0].exterior.coords[2][0],v['geometry'][0].exterior.coords[3][0]])
        꼭짓점y좌표.extend([v['geometry'][0].exterior.coords[0][1],v['geometry'][0].exterior.coords[1][1],
                            v['geometry'][0].exterior.coords[2][1],v['geometry'][0].exterior.coords[3][1]])
        꼭짓점값.extend([v[데이터.columns[0]]/4,v[데이터.columns[0]]/4,v[데이터.columns[0]]/4,v[데이터.columns[0]]/4])
        중앙x좌표.append(v['geometry'].bounds[0]/2+v['geometry'].bounds[2]/2)
        중앙y좌표.append(v['geometry'].bounds[1]/2+v['geometry'].bounds[3]/2)
        중앙값.append(v[데이터.columns[0]])
    del 데이터['geometry']
    꼭짓점 = pd.DataFrame({데이터.columns[0]:꼭짓점값, 'lon':꼭짓점x좌표, 'lat':꼭짓점y좌표})
    중앙 = pd.DataFrame({데이터.columns[0]:중앙값, 'lon':중앙x좌표, 'lat':중앙y좌표})
    데이터 = pd.concat([꼭짓점,중앙], ignore_index=True, axis=0)
    return 데이터
```


```python
# 격자 데이터 가져오기
GetCompasData('SBJ_2012_001', '2', '2.오산시_어린이교통사고_격자.geojson')
GetCompasData('SBJ_2012_001', '3', '3.오산시_차량등록현황_격자.geojson')
GetCompasData('SBJ_2012_001', '4', '4.오산시_연령별_거주인구격자(총인구).geojson')
GetCompasData('SBJ_2012_001', '5', '5.오산시_연령별_거주인구격자(유소년).geojson')
GetCompasData('SBJ_2012_001', '6', '6.오산시_연령별_거주인구격자(생산가능인구).geojson')
GetCompasData('SBJ_2012_001', '7', '7.오산시_연령별_거주인구격자(고령).geojson')
# 격자 데이터 입력 (편의를 위해 데이터명을 한글로 명확히 지정)
어린이교통사고_격자 = gpd.read_file('2.오산시_어린이교통사고_격자.geojson')
차량등록현황_격자 = gpd.read_file("3.오산시_차량등록현황_격자.geojson")
총인구_격자 = gpd.read_file("4.오산시_연령별_거주인구격자(총인구).geojson")
유소년인구_격자 = gpd.read_file("5.오산시_연령별_거주인구격자(유소년).geojson")
생산가능인구_격자 = gpd.read_file("6.오산시_연령별_거주인구격자(생산가능인구).geojson")
고령인구_격자 = gpd.read_file("7.오산시_연령별_거주인구격자(고령).geojson")
```


```python
# 격자 데이터를 한 눈에 알아보기 쉽게 column명을 재설정하였습니다
어린이교통사고_격자 = 어린이교통사고_격자.rename(columns = {"accident_cnt":"어린이교통사고횟수"})
차량등록현황_격자 = 차량등록현황_격자.rename(columns = {"car_cnt":"차량등록수"})
총인구_격자 = 총인구_격자.rename(columns = {"val":"총인구"})
유소년인구_격자 = 유소년인구_격자.rename(columns = {"val":"유소년인구"})
생산가능인구_격자 = 생산가능인구_격자.rename(columns = {"val":"생산가능인구"})
고령인구_격자 = 고령인구_격자.rename(columns = {"val":"고령인구"})
```


```python
# gid 데이터는 추후 다루지 않을 예정이니 삭제하였습니다 
del 어린이교통사고_격자['gid']
del 차량등록현황_격자['gid']
del 총인구_격자['gid']
del 유소년인구_격자['gid']
del 생산가능인구_격자['gid']
del 고령인구_격자['gid']

# 다룰 수 없는 NaN값을 0값으로 바꾸었습니다
총인구_격자 = 총인구_격자.fillna(0.0)
유소년인구_격자 = 유소년인구_격자.fillna(0.0)
생산가능인구_격자 = 생산가능인구_격자.fillna(0.0)
고령인구_격자 = 고령인구_격자.fillna(0.0)
```


```python
# 격자의 꼭짓점 좌표를 추가하여 반환하였습니다. 이제 모든 주어진 격자 데이터들은 조밀한 값을 가집니다 (70x70)
어린이교통사고_격자 = 격자줄이기(어린이교통사고_격자)
어린이교통사고_격자 = 어린이교통사고_격자.groupby(['lon','lat'], as_index=True)['어린이교통사고횟수'].sum().reset_index()
차량등록현황_격자 = 격자줄이기(차량등록현황_격자)
차량등록현황_격자 = 차량등록현황_격자.groupby(['lon','lat'], as_index=True)['차량등록수'].sum().reset_index()
총인구_격자 = 격자줄이기(총인구_격자)
총인구_격자 = 총인구_격자.groupby(['lon','lat'], as_index=True)['총인구'].sum().reset_index()
유소년인구_격자 = 격자줄이기(유소년인구_격자)
유소년인구_격자 = 유소년인구_격자.groupby(['lon','lat'], as_index=True)['유소년인구'].sum().reset_index()
생산가능인구_격자 = 격자줄이기(생산가능인구_격자)
생산가능인구_격자 = 생산가능인구_격자.groupby(['lon','lat'], as_index=True)['생산가능인구'].sum().reset_index()
고령인구_격자 = 격자줄이기(고령인구_격자)
고령인구_격자 = 고령인구_격자.groupby(['lon','lat'], as_index=True)['고령인구'].sum().reset_index()
```


```python
# 격자 데이터 전 후 데이터 row개수를 비교하였습니다
# 격자 데이터 조밀화를 하기 전에는 4510개의 100x100 격자 데이터로만 존재하였습니다
GetCompasData('SBJ_2012_001', '2', '2.오산시_어린이교통사고_격자.geojson')
어린이교통사고_격자_원래격자 = gpd.read_file('2.오산시_어린이교통사고_격자.geojson')
어린이교통사고_격자_원래격자 = 어린이교통사고_격자_원래격자.rename(columns = {"accident_cnt":"어린이교통사고횟수"})
어린이교통사고_격자_원래격자
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gid</th>
      <th>어린이교통사고횟수</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>다사551085</td>
      <td>0</td>
      <td>MULTIPOLYGON (((126.99422 37.17418, 126.99421 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>다사551086</td>
      <td>0</td>
      <td>MULTIPOLYGON (((126.99421 37.17508, 126.99420 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>다사551087</td>
      <td>0</td>
      <td>MULTIPOLYGON (((126.99420 37.17599, 126.99420 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>다사551088</td>
      <td>0</td>
      <td>MULTIPOLYGON (((126.99420 37.17689, 126.99419 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>다사552085</td>
      <td>0</td>
      <td>MULTIPOLYGON (((126.99534 37.17419, 126.99534 ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4505</th>
      <td>다사646052</td>
      <td>0</td>
      <td>MULTIPOLYGON (((127.10138 37.14484, 127.10138 ...</td>
    </tr>
    <tr>
      <th>4506</th>
      <td>다사646053</td>
      <td>0</td>
      <td>MULTIPOLYGON (((127.10138 37.14575, 127.10137 ...</td>
    </tr>
    <tr>
      <th>4507</th>
      <td>다사647050</td>
      <td>0</td>
      <td>MULTIPOLYGON (((127.10252 37.14305, 127.10251 ...</td>
    </tr>
    <tr>
      <th>4508</th>
      <td>다사647051</td>
      <td>0</td>
      <td>MULTIPOLYGON (((127.10251 37.14395, 127.10251 ...</td>
    </tr>
    <tr>
      <th>4509</th>
      <td>다사647052</td>
      <td>0</td>
      <td>MULTIPOLYGON (((127.10251 37.14485, 127.10250 ...</td>
    </tr>
  </tbody>
</table>
<p>4510 rows × 3 columns</p>
</div>




```python
# 격자 데이터 조밀화 진행 이후에는 9244개의 70x70 격자 데이터로 바뀌었습니다
# 이제 이 격자 데이터에 모든 변수들을 집어넣어 머신러닝 모델에 넣을 것이기 때문에 
# 이 과정은 매우 중요하다고 할 수 있습니다
격자_조밀한격자 = 어린이교통사고_격자.copy()
del 격자_조밀한격자['어린이교통사고횟수']
격자_조밀한격자
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9239</th>
      <td>127.103080</td>
      <td>37.143498</td>
    </tr>
    <tr>
      <th>9240</th>
      <td>127.103631</td>
      <td>37.145754</td>
    </tr>
    <tr>
      <th>9241</th>
      <td>127.103636</td>
      <td>37.144852</td>
    </tr>
    <tr>
      <th>9242</th>
      <td>127.103640</td>
      <td>37.143951</td>
    </tr>
    <tr>
      <th>9243</th>
      <td>127.103645</td>
      <td>37.143049</td>
    </tr>
  </tbody>
</table>
<p>9244 rows × 2 columns</p>
</div>



# <a id=2>2. 어린이 보호구역 외 어린이 교통사고 위험지역 20개소 제시

**현 정부는 지역별, 유형별 특성에 맞는 어린이 보호구역 정비 표준모델을 마련하였습니다**  
**표준모델에 따르면 어린이 보호구역 지정여부를 조사할 때는 밑의 5가지 데이터를 이용한다고 합니다**  
**그러므로 COMPAS에서 준 데이터를 잘 활용하면 현재 어린이 보호구역 외에 추가로 어린이 교통사고 위험지역을 도출해낼 수 있습니다**

-	어린이 보행 : 유동인구(등하교시간) * 어린이인구/총인구
-	자동차 통행량 : 전체 추정 교통량
-	도로의 신호기
-	시설(초등학교, 학원, 공원, 생활체육시설, 장애인시설) 주변
-	연간 교통사고 발생현황

# 2-1. 데이터 전처리 단계<a id=2-1></a>

## (1) 유동인구 데이터 전처리<a id=2-1-1></a>

#### 데이터 분석 목록

8. 오산시_유동인구(2019).csv

- 유동인구는 50x50 조밀도로 데이터가 주어졌습니다
- 유동인구는 2019년 1월~12월까지의 데이터가 있지만 각 월마다 측정한 좌표값의 개수가 다르므로 가장 많이 측정된 5월을 기준으로 하였습니다
- 5월 유동인구는 총 11411곳이 측정되었습니다
- 초등학생 아이들의 등하교 시간을 기준으로 측정해야 정확합니다
- 등교 시간은 8-9시 안에 대부분 완료됩니다
- 하교 시간은 4교시, 5교시, 6교시를 할 때가 매번 다르므로 1-2시와 2-3시를 기준으로 합니다


```python
# COMPAS에서 제공하는 유동인구 데이터를 불러왔습니다
GetCompasData('SBJ_2012_001', '8', '8.오산시_유동인구(2019).csv')
유동인구 = pd.read_csv("8.오산시_유동인구(2019).csv")
유동인구
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STD_YM</th>
      <th>lon</th>
      <th>lat</th>
      <th>TMST_00</th>
      <th>TMST_01</th>
      <th>TMST_02</th>
      <th>TMST_03</th>
      <th>TMST_04</th>
      <th>TMST_05</th>
      <th>TMST_06</th>
      <th>TMST_07</th>
      <th>TMST_08</th>
      <th>TMST_09</th>
      <th>TMST_10</th>
      <th>TMST_11</th>
      <th>TMST_12</th>
      <th>TMST_13</th>
      <th>TMST_14</th>
      <th>TMST_15</th>
      <th>TMST_16</th>
      <th>TMST_17</th>
      <th>TMST_18</th>
      <th>TMST_19</th>
      <th>TMST_20</th>
      <th>TMST_21</th>
      <th>TMST_22</th>
      <th>TMST_23</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>201901</td>
      <td>126.995145</td>
      <td>37.176703</td>
      <td>0.08</td>
      <td>0.05</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.08</td>
      <td>0.27</td>
      <td>0.80</td>
      <td>0.94</td>
      <td>0.68</td>
      <td>0.70</td>
      <td>0.73</td>
      <td>0.69</td>
      <td>0.64</td>
      <td>0.72</td>
      <td>0.69</td>
      <td>0.76</td>
      <td>0.95</td>
      <td>0.91</td>
      <td>0.70</td>
      <td>0.43</td>
      <td>0.34</td>
      <td>0.22</td>
      <td>0.14</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>201901</td>
      <td>126.995142</td>
      <td>37.177153</td>
      <td>0.06</td>
      <td>0.04</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.06</td>
      <td>0.19</td>
      <td>0.56</td>
      <td>0.72</td>
      <td>0.53</td>
      <td>0.54</td>
      <td>0.57</td>
      <td>0.55</td>
      <td>0.52</td>
      <td>0.55</td>
      <td>0.54</td>
      <td>0.58</td>
      <td>0.69</td>
      <td>0.66</td>
      <td>0.51</td>
      <td>0.33</td>
      <td>0.26</td>
      <td>0.17</td>
      <td>0.11</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201901</td>
      <td>126.995714</td>
      <td>37.175804</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.01</td>
      <td>0.03</td>
      <td>0.05</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.05</td>
      <td>0.05</td>
      <td>0.03</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>201901</td>
      <td>126.995711</td>
      <td>37.176254</td>
      <td>0.05</td>
      <td>0.03</td>
      <td>0.02</td>
      <td>0.03</td>
      <td>0.05</td>
      <td>0.19</td>
      <td>0.56</td>
      <td>0.65</td>
      <td>0.47</td>
      <td>0.48</td>
      <td>0.51</td>
      <td>0.48</td>
      <td>0.45</td>
      <td>0.50</td>
      <td>0.48</td>
      <td>0.53</td>
      <td>0.65</td>
      <td>0.63</td>
      <td>0.48</td>
      <td>0.29</td>
      <td>0.23</td>
      <td>0.15</td>
      <td>0.10</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>201901</td>
      <td>126.995708</td>
      <td>37.176705</td>
      <td>0.02</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.02</td>
      <td>0.07</td>
      <td>0.18</td>
      <td>0.24</td>
      <td>0.19</td>
      <td>0.20</td>
      <td>0.20</td>
      <td>0.20</td>
      <td>0.19</td>
      <td>0.20</td>
      <td>0.19</td>
      <td>0.20</td>
      <td>0.23</td>
      <td>0.22</td>
      <td>0.17</td>
      <td>0.11</td>
      <td>0.09</td>
      <td>0.06</td>
      <td>0.04</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>125158</th>
      <td>201912</td>
      <td>127.097213</td>
      <td>37.154107</td>
      <td>0.09</td>
      <td>0.07</td>
      <td>0.05</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.05</td>
      <td>0.07</td>
      <td>0.11</td>
      <td>0.11</td>
      <td>0.11</td>
      <td>0.11</td>
      <td>0.11</td>
      <td>0.11</td>
      <td>0.11</td>
      <td>0.12</td>
      <td>0.12</td>
      <td>0.12</td>
      <td>0.14</td>
      <td>0.14</td>
      <td>0.14</td>
      <td>0.14</td>
      <td>0.12</td>
      <td>0.11</td>
    </tr>
    <tr>
      <th>125159</th>
      <td>201912</td>
      <td>127.097819</td>
      <td>37.145997</td>
      <td>0.23</td>
      <td>0.18</td>
      <td>0.12</td>
      <td>0.09</td>
      <td>0.09</td>
      <td>0.11</td>
      <td>0.14</td>
      <td>0.19</td>
      <td>0.25</td>
      <td>0.25</td>
      <td>0.26</td>
      <td>0.26</td>
      <td>0.25</td>
      <td>0.26</td>
      <td>0.28</td>
      <td>0.28</td>
      <td>0.30</td>
      <td>0.34</td>
      <td>0.34</td>
      <td>0.35</td>
      <td>0.35</td>
      <td>0.34</td>
      <td>0.32</td>
      <td>0.28</td>
    </tr>
    <tr>
      <th>125160</th>
      <td>201912</td>
      <td>127.097793</td>
      <td>37.150955</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.02</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>125161</th>
      <td>201912</td>
      <td>127.098354</td>
      <td>37.151407</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.02</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>125162</th>
      <td>201912</td>
      <td>127.100634</td>
      <td>37.146006</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.05</td>
      <td>0.05</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.04</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.02</td>
    </tr>
  </tbody>
</table>
<p>125163 rows × 27 columns</p>
</div>




```python
# 유동인구 데이터를 가장 많은 곳이 측정된 5월을 기준으로 처리하였습니다
유동인구 = 유동인구.drop(유동인구.loc[유동인구['STD_YM']!=201905].index, inplace=False).reset_index()
# 오산시 어린이보호구역 보행안전 확보방안 연구원에서 발표한 어린이 보호구역 내 사교율을 분석한 결과 
# 8시부터 9시까지의 사교율이 12.5%인 반면 하교시간 사교율은 50% 이상이므로
# 실제 데이터와 맞도록 적당히 가중치를 부여하여 데이터를 설정해주었습니다
유동인구['TMST_08'] = 유동인구['TMST_08'] * 1
유동인구['TMST_13'] = 유동인구['TMST_13'] * 2
유동인구['TMST_14'] = 유동인구['TMST_14'] * 2
유동인구['총유동인구'] = 유동인구['TMST_08'] + 유동인구['TMST_13'] + 유동인구['TMST_14']
유동인구 = 유동인구.loc[:,['lon', 'lat', '총유동인구']]
유동인구['총유동인구'] = 유동인구['총유동인구']
유동인구
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>총유동인구</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.995154</td>
      <td>37.175351</td>
      <td>0.60</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.995151</td>
      <td>37.175801</td>
      <td>0.64</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.995148</td>
      <td>37.176252</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.995145</td>
      <td>37.176703</td>
      <td>3.23</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.995142</td>
      <td>37.177153</td>
      <td>2.57</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11406</th>
      <td>127.096715</td>
      <td>37.141937</td>
      <td>0.18</td>
    </tr>
    <tr>
      <th>11407</th>
      <td>127.096638</td>
      <td>37.156359</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>11408</th>
      <td>127.097278</td>
      <td>37.141939</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>11409</th>
      <td>127.097767</td>
      <td>37.155912</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>11410</th>
      <td>127.100634</td>
      <td>37.146006</td>
      <td>0.10</td>
    </tr>
  </tbody>
</table>
<p>11411 rows × 3 columns</p>
</div>




```python
# 전처리한 유동인구 데이터를 pydeck을 이용하여 시각화 하였습니다
유동인구맵 = pdk.Layer(
    'ScatterplotLayer',
    유동인구,
    get_position='[lon, lat]',
    get_radius='총유동인구/5',
    get_fill_color = '[200, 총유동인구*3, 200, 총유동인구*3]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 유동인구맵],
            mapbox_key = 'pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw',
            initial_view_state=view_state)
맵.to_html("유동인구맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/유동인구맵.PNG'>

## (2) 어린이인구, 총인구 전처리

#### 데이터 분석 목록
4. 오산시_연령별_거주인구격자(총인구).geojson
5. 오산시_연령별_거주인구격자(유소년).geojson

- 우리가 원하는 값은 총인구 대비 어린이 인구이다
- 유동인구 데이터에는 단순히 격자 내 총인구 데이터만 등록이 되어 있다
- 그러므로 유동인구 데이터와 유소년인구비율 데이터가 함께 있어야 어린이 보행자수를 알 수 있다


```python
# 격자 데이터 처리단계에서 이미 안구 데이터 처리를 마쳤기때문에 그대로 가져다 사용하였습니다
인구분포 = 유소년인구_격자.merge(총인구_격자)
# 유소년인구비율을 구해야하므로 유소년인구에 총인구를 나누어주어야 합니다
인구분포['유소년인구비율'] = 인구분포['유소년인구'] / 인구분포['총인구']
인구분포 = 인구분포.dropna(axis=0).reset_index(drop=True)
인구분포 = 인구분포.drop(인구분포[인구분포['유소년인구비율']==0.0].index).reset_index(drop=True)
유소년인구비율 = 인구분포.loc[:,['lon','lat','유소년인구비율']]
유소년인구비율
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>유소년인구비율</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.021113</td>
      <td>37.195928</td>
      <td>0.028302</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.021119</td>
      <td>37.195026</td>
      <td>0.027650</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.021680</td>
      <td>37.195479</td>
      <td>0.084507</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.022240</td>
      <td>37.195932</td>
      <td>0.046512</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.022246</td>
      <td>37.195031</td>
      <td>0.034483</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1771</th>
      <td>127.093478</td>
      <td>37.149325</td>
      <td>0.211207</td>
    </tr>
    <tr>
      <th>1772</th>
      <td>127.093482</td>
      <td>37.148424</td>
      <td>0.216152</td>
    </tr>
    <tr>
      <th>1773</th>
      <td>127.094028</td>
      <td>37.151580</td>
      <td>0.136842</td>
    </tr>
    <tr>
      <th>1774</th>
      <td>127.094589</td>
      <td>37.152033</td>
      <td>0.136842</td>
    </tr>
    <tr>
      <th>1775</th>
      <td>127.094594</td>
      <td>37.151132</td>
      <td>0.136842</td>
    </tr>
  </tbody>
</table>
<p>1776 rows × 3 columns</p>
</div>




```python
# 전처리한 유소년인구비율을 pydeck을 이용하여 시각화 하였습니다

유소년인구비율맵 = pdk.Layer(
    'ScatterplotLayer',
    유소년인구비율,
    get_position='[lon, lat]',
    get_radius='500*유소년인구비율',
    get_fill_color = '[200, 유소년인구비율*200, 200, 유소년인구비율*200]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 유소년인구비율맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("유소년인구비율맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/유소년인구비율맵.PNG'>

## (3) 자동차 통행량 전처리<a id=2-1-3></a>

#### 데이터 분석 목록
23. 오산시_상세도로망_LV6.geojson
24. 평일_전일,시간대별_오산시_추정교통량_Level6.csv

- 오산시 추정교통량 데이터에는 모든 시간 별 데이터가 들어있지만, 특정 시간대에는 측정되지 않은 도로가 있었습니다
- 그러므로 추정교통량 데이터 중 모든 도로가 측정된, 그리고 어린이들의 보행이 잦은 2-3시 데이터를 뽑았습니다
- 추정교통량 데이터에는 link_id는 있지만 도로위치가 없으므로, link_id와 도로위치를 함께 가진 상세도로망 데이터와 매핑을 하였습니다


```python
# 오산시 내 추정 교통량과 상세도로망을 불러왔습니다
GetCompasData('SBJ_2012_001', '23', '23.오산시_상세도로망_LV6.geojson')
GetCompasData('SBJ_2012_001', '24', '24.평일_전일,시간대별_오산시_추정교통량_Level6.csv')
상세도로망 = gpd.read_file("23.오산시_상세도로망_LV6.geojson")
추정교통량 = pd.read_csv("24.평일_전일,시간대별_오산시_추정교통량_Level6.csv")
```


```python
# 모든 도로가 측정된, 그리고 어린이들의 보행이 잦은 2-3시 데이터를 제외하고 모두 제거하였습니다
추정교통량 = 추정교통량.drop(추정교통량.loc[추정교통량['시간적범위']!='14'].index).reset_index(drop=True)
# 추정교통랑에 있는 link_id에서 뒤의 두 자리를 제거해줘야 상세도로망에 있는 link_id와 같아지므로 데이터 처리를 수행하였습니다
link_id = []
for i, v in 추정교통량.iterrows():
    link_id.append(str(v['상세도로망_LinkID'])[:-2])
추정교통량['link_id']=link_id
추정교통량 = 추정교통량.astype({'link_id': 'int'})
추정교통량 = 추정교통량.rename(columns = {'전체 추정교통량': '추정교통량'})
추정교통량 = 추정교통량.loc[:,['link_id','추정교통량']]
추정교통량
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>link_id</th>
      <th>추정교통량</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>571376979</td>
      <td>1934.82</td>
    </tr>
    <tr>
      <th>1</th>
      <td>571352496</td>
      <td>130.44</td>
    </tr>
    <tr>
      <th>2</th>
      <td>571352506</td>
      <td>118.59</td>
    </tr>
    <tr>
      <th>3</th>
      <td>571376966</td>
      <td>1088.58</td>
    </tr>
    <tr>
      <th>4</th>
      <td>571376977</td>
      <td>1931.04</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3272</th>
      <td>571251000</td>
      <td>4002.45</td>
    </tr>
    <tr>
      <th>3273</th>
      <td>571241039</td>
      <td>3596.90</td>
    </tr>
    <tr>
      <th>3274</th>
      <td>571210004</td>
      <td>3994.39</td>
    </tr>
    <tr>
      <th>3275</th>
      <td>571241030</td>
      <td>3546.48</td>
    </tr>
    <tr>
      <th>3276</th>
      <td>571250998</td>
      <td>4002.48</td>
    </tr>
  </tbody>
</table>
<p>3277 rows × 2 columns</p>
</div>




```python
# 데이터 타입이 맞지 않으므로 문자열 타입으로 된 데이터들을 정수, 실수로 맞추어줍니다
상세도로망 = 상세도로망.astype({'barrier':'int', 'link_id':'int', 'num_cross':'int','length':'float', 'max_speed':'int'})
# 도로의 길이가 서로 다르므로 도로신호등의 수를 도로 길이로 나누어주어야 신호등수비율을 구합니다
상세도로망['도로신호등'] = 상세도로망['num_cross'] / 상세도로망['length']
# 상세 도로망의 데이터 중 제한속도 데이터와 중앙분리 데이터 이외의 데이터는 제거하였습니다
상세도로망 = 상세도로망.loc[:,['link_id','max_speed','width','도로신호등','barrier','geometry']]
# 중앙분리대의 종류가 다 다르므로 타입 별 안전도를 지정해주었습니다
# COMPAS에서 주어진 중앙분리대 코드 정리 : 0-분리대없음, 1-벽, 2-봉, 3-화단, 4-안전지대, 5-금속, 15-기타
# 각 중앙분리대별 안전도 재설정 : 벽-20, 봉-2, 화단-5, 안전지대-15, 금속-5, 기타-5
상세도로망['barrier'] = 상세도로망['barrier'].replace({0:0, 1:20, 2:2, 3:5, 5:15, 15:5})
# 제한속도 값이 낮을수록 안전하므로 제한속도마다 안전도를 지정해주었습니다
상세도로망['max_speed'] = 상세도로망['max_speed'].replace({20:8, 30:7, 40:6, 50:5, 60:4, 70:3, 80:2, 100:1, 110:1})
상세도로망
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>link_id</th>
      <th>max_speed</th>
      <th>width</th>
      <th>도로신호등</th>
      <th>barrier</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>478344684</td>
      <td>4</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((126.99779 37.17385, 126.9979...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>478344686</td>
      <td>4</td>
      <td>2</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((126.99779 37.17385, 126.9978...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>478344690</td>
      <td>4</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((127.00104 37.18002, 127.0009...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>478344696</td>
      <td>4</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((126.99614 37.17621, 126.9963...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>478344700</td>
      <td>6</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((126.99770 37.17692, 126.9975...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1870</th>
      <td>571376981</td>
      <td>1</td>
      <td>2</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((127.04011 37.17816, 127.0467...</td>
    </tr>
    <tr>
      <th>1871</th>
      <td>571376982</td>
      <td>1</td>
      <td>2</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((127.04770 37.18087, 127.0478...</td>
    </tr>
    <tr>
      <th>1872</th>
      <td>571376983</td>
      <td>1</td>
      <td>2</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((127.04674 37.18053, 127.0477...</td>
    </tr>
    <tr>
      <th>1873</th>
      <td>900000166</td>
      <td>0</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((127.05992 37.16942, 127.0601...</td>
    </tr>
    <tr>
      <th>1874</th>
      <td>900000167</td>
      <td>0</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>MULTILINESTRING ((127.06042 37.16975, 127.0603...</td>
    </tr>
  </tbody>
</table>
<p>1875 rows × 6 columns</p>
</div>




```python
# 추정 교통량과 상세 도로망을 매핑시킬 수 있습니다 (link_id가 동일하므로)
도로별데이터 = gpd.GeoDataFrame(pd.merge(추정교통량,상세도로망[['link_id','max_speed','도로신호등','barrier','width','geometry']]).reset_index(drop=True))
# pydeck에서 시각화를 할 수 있도록 geometry값을 좌표값으로 변환시켰습니다 (선좌표)
도로별데이터['선좌표'] = 도로별데이터['geometry'].apply(멀티선_좌표리스트_변환)
# 도로 정보값을 격자 데이터에 넣어야하므로 80m만큼씩 양옆으로 오프셋시켜줍니다 (선폴리곤)
# 나중에 격자 데이터에 넣을 때 선폴리곤으로 변한 도로데이터 내에 격자포인트가 존재하면 
# 데이터를 넣어주는 형식으로 다룰 것이기 때문입니다
도로별데이터['선폴리곤'] = 도로별데이터['geometry'].buffer(0.0016)
del 도로별데이터['geometry']
도로별데이터 = 도로별데이터.rename(columns={'max_speed':'제한속도','barrier':'중앙분리대','width':'도로폭'})
도로별데이터 = pd.DataFrame(도로별데이터)
도로별데이터
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>link_id</th>
      <th>추정교통량</th>
      <th>제한속도</th>
      <th>도로신호등</th>
      <th>중앙분리대</th>
      <th>도로폭</th>
      <th>선좌표</th>
      <th>선폴리곤</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>571376979</td>
      <td>1934.82</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>2</td>
      <td>[[127.04764127110481, 37.18097074603847], [127...</td>
      <td>POLYGON ((127.04719 37.17913, 127.04704 37.179...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>571352496</td>
      <td>130.44</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>[[127.0350838397857, 37.176630728117445], [127...</td>
      <td>POLYGON ((127.03541 37.17829, 127.03555 37.178...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>571352506</td>
      <td>118.59</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>[[127.03669801090145, 37.17877185619187], [127...</td>
      <td>POLYGON ((127.03448 37.17838, 127.03448 37.178...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>571376966</td>
      <td>1088.58</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>2</td>
      <td>[[126.99839199457229, 37.17634723616157], [126...</td>
      <td>POLYGON ((127.00051 37.17705, 127.00080 37.176...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>571376977</td>
      <td>1931.04</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
      <td>2</td>
      <td>[[127.04667514345924, 37.180639998416254], [12...</td>
      <td>POLYGON ((127.04705 37.17908, 127.04030 37.176...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3272</th>
      <td>571251000</td>
      <td>4002.45</td>
      <td>6</td>
      <td>0.0</td>
      <td>0</td>
      <td>3</td>
      <td>[[127.08229541818612, 37.14325360376103], [127...</td>
      <td>POLYGON ((127.08321 37.14496, 127.08336 37.144...</td>
    </tr>
    <tr>
      <th>3273</th>
      <td>571241039</td>
      <td>3596.90</td>
      <td>5</td>
      <td>0.0</td>
      <td>0</td>
      <td>3</td>
      <td>[[127.08197064631345, 37.143378374711595], [12...</td>
      <td>POLYGON ((127.08196 37.14177, 127.08194 37.141...</td>
    </tr>
    <tr>
      <th>3274</th>
      <td>571210004</td>
      <td>3994.39</td>
      <td>5</td>
      <td>0.0</td>
      <td>0</td>
      <td>3</td>
      <td>[[127.08060135736511, 37.143020004552966], [12...</td>
      <td>POLYGON ((127.08094 37.14464, 127.08113 37.144...</td>
    </tr>
    <tr>
      <th>3275</th>
      <td>571241030</td>
      <td>3546.48</td>
      <td>6</td>
      <td>0.0</td>
      <td>0</td>
      <td>2</td>
      <td>[[127.0834048906924, 37.146229368699316], [127...</td>
      <td>POLYGON ((127.08176 37.14497, 127.08173 37.145...</td>
    </tr>
    <tr>
      <th>3276</th>
      <td>571250998</td>
      <td>4002.48</td>
      <td>6</td>
      <td>0.0</td>
      <td>0</td>
      <td>2</td>
      <td>[[127.08338127671196, 37.14337209785966], [127...</td>
      <td>POLYGON ((127.08339 37.14177, 127.08337 37.141...</td>
    </tr>
  </tbody>
</table>
<p>3277 rows × 8 columns</p>
</div>




```python
# 추정교통량 데이터를 pydeck을 이용하여 시각화 하였습니다
추정교통량맵 = pdk.Layer(
    'PathLayer',
    도로별데이터,
    get_path='선좌표',
    get_width='도로폭*8',
    get_color='[추정교통량/10, 0, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 추정교통량맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("추정교통량맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/추정교통량맵.PNG'>


```python
# 중앙분리대 데이터를 pydeck을 이용하여 시각화 하였습니다
중앙분리대맵 = pdk.Layer(
    'PathLayer',
    도로별데이터,
    get_path='선좌표',
    get_width='도로폭*8',
    get_color='[0, 50*중앙분리대, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 중앙분리대맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("중앙분리대맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/중앙분리대맵.PNG'>


```python
# 도로신호등 데이터를 pydeck을 이용하여 시각화 하였습니다
도로신호등맵 = pdk.Layer(
    'PathLayer',
    도로별데이터,
    get_path='선좌표',
    get_width='도로폭*8',
    get_color='[100*도로신호등, 100*도로신호등, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 도로신호등맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("도로신호등맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/도로신호등맵.PNG'>

## (4) 주변시설(초등학교, 학원, 공원, 생활체육시설, 장애인시설)<a id=2-1-4></a>

#### 데이터 분석 목록
10. 오산시_학교위치정보.csv
13. 오산시_어린이집_유치원현황.csv
29. 오산시_체육시설현황.csv
30. 오산시_학원및교습소_현황.csv

- 교통약자에 대한 보호구역은 2011년 '어린이·노인·장애인 보호구역의 지정 및 관리 규칙' 이 제정됨 
- 학원, 공원, 생활체육시설, 장애인시설 등으로 보호구역 지정시설이 확대되어 교통약자에 대한 보호구역 일원화


```python
# COMPAS에서 제공하는 주변시설 데이터를 가져왔습니다
GetCompasData('SBJ_2012_001', '10', '10.오산시_학교위치정보.csv')
GetCompasData('SBJ_2012_001', '13', '13.오산시_어린이집_유치원현황.csv')
GetCompasData('SBJ_2012_001', '29', '29.오산시_체육시설현황.csv')
GetCompasData('SBJ_2012_001', '30', '30.오산시_학원_및_교습소_현황.csv')
학교위치정보 = pd.read_csv("10.오산시_학교위치정보.csv")
어린이집유치원현황 = pd.read_csv("13.오산시_어린이집_유치원현황.csv")
체육시설현황 = pd.read_csv("29.오산시_체육시설현황.csv")
학원및교습소현황 = pd.read_csv("30.오산시_학원_및_교습소_현황.csv")
```


```python
# 주어진 학교 위치정보 현황에서 중학교와 고등학교는 제외시켰습니다 (어린이 보호구역 정비 표준모델에 의거)
학교위치정보 = 학교위치정보.drop(학교위치정보[학교위치정보['학교구분']!='초등학교'].index).reset_index(drop=True)
학교위치정보 = 학교위치정보.replace('초등학교',1)
학교위치정보 = 학교위치정보.rename(columns = {'학교구분':'초등학교', '학교위치_경도':'lon', '학교위치_위도':'lat'})
초등학교 = 학교위치정보.loc[:,['lon', 'lat','초등학교']]
초등학교.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>초등학교</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.069699</td>
      <td>37.135168</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.077414</td>
      <td>37.152500</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.068858</td>
      <td>37.164615</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.047749</td>
      <td>37.147919</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.090752</td>
      <td>37.151698</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 전처리한 초등학교 데이터를 pydeck을 이용하여 시각화 하였습니다
초등학교맵 = pdk.Layer(
    'ScatterplotLayer',
    초등학교,
    get_position='[lon, lat]',
    get_radius='200',
    get_fill_color = '[0, 200, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 초등학교맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("초등학교맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/초등학교맵.PNG'>


```python
# 주어진 어린이집유치원 현황에는 어린이집과 유치원 두 가지 데이터가 있습니다
# 어린이집은 0-7세를 대상으로 운영하고 유치원은 5-7세를 대상으로 운영하므로 따로 분류하였습니다
어린이집 = 어린이집유치원현황.drop(어린이집유치원현황[어린이집유치원현황['시설구분']!='어린이집'].index).reset_index(drop=True)
어린이집 = 어린이집.replace('어린이집',1)
어린이집 = 어린이집.rename(columns = {'시설위치_경도':'lon','시설위치_위도':'lat','시설구분':'어린이집'})
어린이집 = 어린이집.loc[:,['lon','lat','어린이집']]
유치원 = 어린이집유치원현황.drop(어린이집유치원현황[어린이집유치원현황['시설구분']!='유치원'].index).reset_index(drop=True)
유치원 = 유치원.replace('유치원',1)
유치원 = 유치원.rename(columns = {'시설위치_경도':'lon','시설위치_위도':'lat','시설구분':'유치원'})
유치원 = 유치원.loc[:,['lon','lat','유치원']]
```


```python
어린이집.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>어린이집</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.084336</td>
      <td>37.132383</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.041817</td>
      <td>37.182164</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.079494</td>
      <td>37.152891</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.049638</td>
      <td>37.177976</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.040252</td>
      <td>37.165311</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 전처리한 어린이집 데이터를 pydeck을 이용하여 시각화 하였습니다
어린이집맵 = pdk.Layer(
    'ScatterplotLayer',
    어린이집,
    get_position='[lon, lat]',
    get_radius='50',
    get_fill_color = '[204, 204, 51]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 어린이집맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("어린이집맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/어린이집맵.PNG'>


```python
유치원.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>유치원</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.090864</td>
      <td>37.141948</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.049953</td>
      <td>37.144756</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.076144</td>
      <td>37.143643</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.079173</td>
      <td>37.156112</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.052553</td>
      <td>37.178499</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 전처리한 유치원맵 데이터를 pydeck을 이용하여 시각화 하였습니다
유치원맵 = pdk.Layer(
    'ScatterplotLayer',
    유치원,
    get_position='[lon, lat]',
    get_radius='100',
    get_fill_color = '[255, 255, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 유치원맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("유치원맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/유치원맵.PNG'>


```python
# 학원및교습소 데이터에는 어린이와 관련이 없는 평생직업교육학원 데이터가 있으므로 제거해주었습니다 
학원및교습소현황 = 학원및교습소현황.drop(학원및교습소현황[학원및교습소현황['업종구분명']=='평생직업교육학원'].index).reset_index(drop=True)
학원및교습소현황['학원및교습소'] = 1
학원및교습소현황 = 학원및교습소현황.rename(columns = {'시설위치_경도':'lon', '시설위치_위도':'lat'})
학원및교습소 = 학원및교습소현황.loc[:,['lon', 'lat','학원및교습소']]
학원및교습소.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>학원및교습소</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.048919</td>
      <td>37.146279</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.048919</td>
      <td>37.146279</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.052419</td>
      <td>37.145809</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.048919</td>
      <td>37.146279</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.048919</td>
      <td>37.146279</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 전처리한 학원및교습소 데이터를 pydeck을 이용하여 시각화 하였습니다
학원및교습소맵 = pdk.Layer(
    'ScatterplotLayer',
    학원및교습소,
    get_position='[lon, lat]',
    get_radius='50',
    get_fill_color = '[255, 51, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 학원및교습소맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("학원및교습소맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/학원및교습소맵.PNG'>


```python
# 체육시설현황 데이터는 따로 처리해야할 것이 없으므로 그대로 사용하였습니다
체육시설현황 = pd.read_csv("29.오산시_체육시설현황.csv")
체육시설현황['체육시설'] = 1
체육시설 = 체육시설현황.rename(columns = {'설치위치_경도':'lon', '설치위치_위도':'lat'})
del 체육시설['시설구분명']
체육시설.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>체육시설</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.073804</td>
      <td>37.157197</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.041923</td>
      <td>37.179440</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.075720</td>
      <td>37.158754</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.077445</td>
      <td>37.149806</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.070223</td>
      <td>37.155640</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 전처리한 체육시설 데이터를 pydeck을 이용하여 시각화 하였습니다
체육시설맵 = pdk.Layer(
    'ScatterplotLayer',
    체육시설,
    get_position='[lon, lat]',
    get_radius='40',
    get_fill_color = '[51, 255, 255]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 체육시설맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("체육시설맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/체육시설맵.PNG'>


```python
# 모든 시설의 데이터를 pydeck을 통해 한 맵 안에서 시각화 해보았습니다
# 시설 당 사람 수, 어린이 분포 수, 연령을 고려하여 반경 범위를 다르게 하여 시각화하였습니다
맵 = pdk.Deck(layers=[읍면동맵, 초등학교맵, 유치원맵, 어린이집맵, 학원및교습소맵, 체육시설맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("시설물전체맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/시설물전체맵.PNG'>

## (5) 연간 교통사고 발생현황<a id=2-1-5></a>

격자 데이터 분석에서 이미 어린이교통사고 데이터를 조밀하게 구했으므로 따로 전처리하지 않는다


```python
# 전처리한 어린이교통사고 데이터를 pydeck을 이용하여 시각화 하였습니다
교통사고맵 = pdk.Layer(
    'ScatterplotLayer',
    어린이교통사고_격자,
    get_position='[lon, lat]',
    get_radius='50',
    get_fill_color = '[255, 10*어린이교통사고횟수, 51, 100*어린이교통사고횟수]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 교통사고맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("교통사고맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/교통사고맵.PNG'>

## (6) COMPAS에서 제공한 나머지 데이터 전처리<a id=2-1-6></a>

#### 데이터 분석 목록
- 1.오산시_주정차단속(2018~2020).csv
- 15.오산시_무인교통단속카메라.csv
- 18.오산시_과속방지턱표준데이터.csv
- 19.오산시_신호등.geojson
- 20.오산시_CCTV설치현황.csv
- 22.오산시_버스정류장.csv


```python
# COMPAS에서 제공하는 오산시 내 보행신호등 데이터를 불러왔습니다
GetCompasData('SBJ_2012_001', '19', '19.오산시_신호등.geojson')
보행신호등 = gpd.read_file("19.오산시_신호등.geojson")
보행신호등
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>POINT (127.07160 37.14407)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>POINT (127.08149 37.12849)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>POINT (127.03978 37.16155)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>POINT (127.03999 37.16168)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>POINT (127.07838 37.14296)</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1493</th>
      <td>1494</td>
      <td>POINT (127.07888 37.15909)</td>
    </tr>
    <tr>
      <th>1494</th>
      <td>1495</td>
      <td>POINT (127.07832 37.15993)</td>
    </tr>
    <tr>
      <th>1495</th>
      <td>1496</td>
      <td>POINT (127.07850 37.15977)</td>
    </tr>
    <tr>
      <th>1496</th>
      <td>1497</td>
      <td>POINT (127.07820 37.15971)</td>
    </tr>
    <tr>
      <th>1497</th>
      <td>1498</td>
      <td>POINT (127.07803 37.15986)</td>
    </tr>
  </tbody>
</table>
<p>1498 rows × 2 columns</p>
</div>




```python
# 주어진 신호등 데이터를 경도와 위도값만 가지도록 변환하였습니다
보행신호등['좌표값'] = 보행신호등['geometry'].apply(포인트_좌표리스트_변환)
포인트리스트_위도경도(보행신호등)
보행신호등['보행신호등'] = 1
보행신호등 = 보행신호등.loc[:,['lon','lat','보행신호등']]
보행신호등 = pd.DataFrame(보행신호등)
보행신호등
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>보행신호등</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.071599</td>
      <td>37.144067</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.081488</td>
      <td>37.128490</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.039777</td>
      <td>37.161546</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.039990</td>
      <td>37.161682</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.078383</td>
      <td>37.142955</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1493</th>
      <td>127.078879</td>
      <td>37.159089</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1494</th>
      <td>127.078323</td>
      <td>37.159930</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1495</th>
      <td>127.078502</td>
      <td>37.159766</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1496</th>
      <td>127.078201</td>
      <td>37.159706</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1497</th>
      <td>127.078033</td>
      <td>37.159865</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>1498 rows × 3 columns</p>
</div>




```python
# 오산시 내 신호등의 위치를 시각화 하였습니다

보행신호등맵 = pdk.Layer(
    'ScatterplotLayer',
    보행신호등,
    get_position='[lon, lat]',
    get_radius='30',
    get_fill_color = '[255, 255, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 보행신호등맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("보행신호등맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/보행신호등맵.PNG'>


```python
# COMPAS에서 제공하는 주정차 단속에 걸린 위치 데이터들을 불러왔습니다
GetCompasData('SBJ_2012_001', '1', '1.오산시_주정차단속(2018~2020).csv')
주정차단속 = pd.read_csv("1.오산시_주정차단속(2018~2020).csv")
주정차단속
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>단속일자</th>
      <th>단속위치</th>
      <th>행정구역</th>
      <th>스쿨존여부</th>
      <th>단속위치_경도</th>
      <th>단속위치_위도</th>
      <th>단속종류</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20181101</td>
      <td>금암동 여계산로 부근</td>
      <td>경기도 오산시 세교동</td>
      <td>N</td>
      <td>127.043462</td>
      <td>37.170237</td>
      <td>이동형CCTV단속</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20181101</td>
      <td>세교동 세마역로19번길</td>
      <td>경기도 오산시 세교동</td>
      <td>N</td>
      <td>127.044770</td>
      <td>37.181695</td>
      <td>이동형CCTV단속</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20181101</td>
      <td>세교동 수목원로 부근</td>
      <td>경기도 오산시 양산동</td>
      <td>N</td>
      <td>127.042200</td>
      <td>37.186357</td>
      <td>이동형CCTV단속</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20181101</td>
      <td>오산동 오산로272번길 부</td>
      <td>경기도 오산시 원동</td>
      <td>N</td>
      <td>127.071732</td>
      <td>37.150557</td>
      <td>이동형CCTV단속</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20181101</td>
      <td>오산동 성호대로93번길</td>
      <td>경기도 오산시 부산동</td>
      <td>N</td>
      <td>127.071757</td>
      <td>37.150457</td>
      <td>이동형CCTV단속</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>61696</th>
      <td>20201111</td>
      <td>GS25궐동대호점 맞은편</td>
      <td>경기도 오산시 청학동</td>
      <td>N</td>
      <td>127.053064</td>
      <td>37.158140</td>
      <td>고정형CCTV단속</td>
    </tr>
    <tr>
      <th>61697</th>
      <td>20201111</td>
      <td>물향기지하도</td>
      <td>경기도 오산시 원동</td>
      <td>N</td>
      <td>127.066157</td>
      <td>37.171143</td>
      <td>고정형CCTV단속</td>
    </tr>
    <tr>
      <th>61698</th>
      <td>20201111</td>
      <td>운암2단지 근린공원삼거</td>
      <td>경기도 오산시 청호동</td>
      <td>N</td>
      <td>127.077283</td>
      <td>37.158126</td>
      <td>고정형CCTV단속</td>
    </tr>
    <tr>
      <th>61699</th>
      <td>20201111</td>
      <td>궐동 양평해장국 사거리</td>
      <td>경기도 오산시 궐동</td>
      <td>N</td>
      <td>127.056665</td>
      <td>37.155827</td>
      <td>고정형CCTV단속</td>
    </tr>
    <tr>
      <th>61700</th>
      <td>20201111</td>
      <td>어울림(북개천) 사거리</td>
      <td>경기도 오산시 부산동</td>
      <td>N</td>
      <td>127.068644</td>
      <td>37.143810</td>
      <td>고정형CCTV단속</td>
    </tr>
  </tbody>
</table>
<p>61701 rows × 7 columns</p>
</div>




```python
# 하나의 위치에서 여러번 단속되었을 수도 있으니 중복값을 더하여 전처리하였습니다
주정차단속 = 주정차단속.rename(columns={'단속위치_경도':'lon','단속위치_위도':'lat'})
주정차단속['주정차단속'] = 1
주정차단속 = 주정차단속.loc[:,['lon', 'lat', '주정차단속']]
주정차단속 = 주정차단속.groupby(['lon','lat'], as_index=True)['주정차단속'].sum().reset_index()
주정차단속
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>주정차단속</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.023123</td>
      <td>37.194803</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.023155</td>
      <td>37.194852</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.023158</td>
      <td>37.195717</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.023160</td>
      <td>37.194680</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.023165</td>
      <td>37.194863</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16512</th>
      <td>127.095912</td>
      <td>37.155645</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16513</th>
      <td>127.095933</td>
      <td>37.155495</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16514</th>
      <td>127.095935</td>
      <td>37.155553</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16515</th>
      <td>127.095952</td>
      <td>37.155415</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16516</th>
      <td>127.095988</td>
      <td>37.155497</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>16517 rows × 3 columns</p>
</div>




```python
# 전처리한 주정차단속 데이터를 pydeck을 이용하여 시각화 하였습니다
주정차단속맵 = pdk.Layer(
    'ScatterplotLayer',
    주정차단속,
    get_position='[lon, lat]',
    get_radius='50',
    get_fill_color = '[주정차단속, 주정차단속, 51, 주정차단속]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 주정차단속맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("주정차단속맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/주정차단속맵.PNG'>


```python
# COMPAS에서 제공하는 무인교통단속카메라 데이터를 불러왔습니다
GetCompasData('SBJ_2012_001', '15', '15.오산시_무인교통단속카메라.csv')
무인교통단속카메라 = pd.read_csv("15.오산시_무인교통단속카메라.csv")
무인교통단속카메라
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도로노선명</th>
      <th>도로노선방향</th>
      <th>설치장소명</th>
      <th>단속구분</th>
      <th>설치위치_경도</th>
      <th>설치위치_위도</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>궐리사로</td>
      <td>양방향</td>
      <td>궐동-법원앞(법원사거리)</td>
      <td>불법주정차</td>
      <td>127.059357</td>
      <td>37.159313</td>
    </tr>
    <tr>
      <th>1</th>
      <td>역광장로</td>
      <td>양방향</td>
      <td>원동-오산역광장</td>
      <td>불법주정차</td>
      <td>127.067796</td>
      <td>37.145409</td>
    </tr>
    <tr>
      <th>2</th>
      <td>궐리사로</td>
      <td>양방향</td>
      <td>궐동-제일하이빌</td>
      <td>불법주정차</td>
      <td>127.062386</td>
      <td>37.159198</td>
    </tr>
    <tr>
      <th>3</th>
      <td>궐리사로</td>
      <td>양방향</td>
      <td>궐리사 주차장 앞</td>
      <td>불법주정차</td>
      <td>127.061920</td>
      <td>37.158559</td>
    </tr>
    <tr>
      <th>4</th>
      <td>운암로</td>
      <td>양방향</td>
      <td>부산동-운천초교 입구</td>
      <td>불법주정차</td>
      <td>127.077991</td>
      <td>37.156216</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>107</th>
      <td>경기동로186번길</td>
      <td>양방향</td>
      <td>시티자이2차 아파트 앞</td>
      <td>불법주정차</td>
      <td>127.091941</td>
      <td>37.154632</td>
    </tr>
    <tr>
      <th>108</th>
      <td>역광장로</td>
      <td>양방향</td>
      <td>오원사거리</td>
      <td>불법주정차</td>
      <td>127.068303</td>
      <td>37.142519</td>
    </tr>
    <tr>
      <th>109</th>
      <td>청학로</td>
      <td>양방향</td>
      <td>차량등록사업소</td>
      <td>불법주정차</td>
      <td>127.064287</td>
      <td>37.158197</td>
    </tr>
    <tr>
      <th>110</th>
      <td>수목원로468번길</td>
      <td>양방향</td>
      <td>세교9단지 후문 상가도로</td>
      <td>불법주정차</td>
      <td>127.050714</td>
      <td>37.175949</td>
    </tr>
    <tr>
      <th>111</th>
      <td>원동로</td>
      <td>양방향</td>
      <td>운암고등학교</td>
      <td>불법주정차</td>
      <td>127.074068</td>
      <td>37.143045</td>
    </tr>
  </tbody>
</table>
<p>112 rows × 6 columns</p>
</div>




```python
# 무인교통단속카메라 데이터를 전처리하였습니다
무인교통단속카메라 = 무인교통단속카메라.rename(columns={'설치위치_경도':'lon','설치위치_위도':'lat'})
무인교통단속카메라['무인교통단속카메라'] = 1
무인교통단속카메라 = 무인교통단속카메라.loc[:,['lon', 'lat', '무인교통단속카메라']]
무인교통단속카메라
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>무인교통단속카메라</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.059357</td>
      <td>37.159313</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.067796</td>
      <td>37.145409</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.062386</td>
      <td>37.159198</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.061920</td>
      <td>37.158559</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.077991</td>
      <td>37.156216</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>107</th>
      <td>127.091941</td>
      <td>37.154632</td>
      <td>1</td>
    </tr>
    <tr>
      <th>108</th>
      <td>127.068303</td>
      <td>37.142519</td>
      <td>1</td>
    </tr>
    <tr>
      <th>109</th>
      <td>127.064287</td>
      <td>37.158197</td>
      <td>1</td>
    </tr>
    <tr>
      <th>110</th>
      <td>127.050714</td>
      <td>37.175949</td>
      <td>1</td>
    </tr>
    <tr>
      <th>111</th>
      <td>127.074068</td>
      <td>37.143045</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>112 rows × 3 columns</p>
</div>




```python
# 전처리한 무인교통단속카메라 데이터를 pydeck을 이용하여 시각화 하였습니다
무인교통단속카메라맵 = pdk.Layer(
    'ScatterplotLayer',
    무인교통단속카메라,
    get_position='[lon, lat]',
    get_radius='50',
    get_fill_color = '[0, 255, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 무인교통단속카메라맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("무인교통단속카메라맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/무인교통단속카메라맵.PNG'>


```python
# COMPAS에서 제공하는 과속방지턱 위치 데이터를 불러왔습니다
GetCompasData('SBJ_2012_001', '18', '18.오산시_과속방지턱표준데이터.csv')
과속방지턱 = gpd.read_file("18.오산시_과속방지턱표준데이터.csv")
과속방지턱.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도로명</th>
      <th>설치장소명</th>
      <th>과속방지턱높이</th>
      <th>과속방지턱폭</th>
      <th>과속방지턱연장</th>
      <th>보차분리여부</th>
      <th>연속형여부</th>
      <th>설치위치_경도</th>
      <th>설치위치_위도</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>오산로</td>
      <td>소망빌 앞</td>
      <td>10</td>
      <td>3.6</td>
      <td>5.4</td>
      <td>N</td>
      <td>Y</td>
      <td>127.0689542</td>
      <td>37.1308521</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>동부대로</td>
      <td>태영철강재공장 앞</td>
      <td>10</td>
      <td>3.6</td>
      <td>5.0</td>
      <td>N</td>
      <td>Y</td>
      <td>127.0763048</td>
      <td>37.1379463</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>밀머리로</td>
      <td>메디마트 앞</td>
      <td>0</td>
      <td>3.6</td>
      <td>5.4</td>
      <td>Y</td>
      <td>Y</td>
      <td>127.0750925</td>
      <td>37.1414665</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>오산로</td>
      <td>다인하우스 앞</td>
      <td>10</td>
      <td>3.6</td>
      <td>10.0</td>
      <td>Y</td>
      <td>Y</td>
      <td>127.071169</td>
      <td>37.1438328</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>운천로</td>
      <td>운천고등학교 앞</td>
      <td>10</td>
      <td>3.6</td>
      <td>6.0</td>
      <td>Y</td>
      <td>Y</td>
      <td>127.0804662</td>
      <td>37.155872</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 과속방지턱높이가 0인 곳도 있으므로 제거를 해준 후 전처리를 해주었습니다
과속방지턱 = 과속방지턱.rename(columns={'설치위치_경도':'lon','설치위치_위도':'lat'})
과속방지턱['과속방지턱'] = 1
과속방지턱 = 과속방지턱.loc[:,['lon', 'lat', '과속방지턱']]
# 위도 경도값이 문자열로 주어져있어 시각화가 안되므로 실수형으로 바꾸어주었습니다
과속방지턱 = 과속방지턱.astype({'lon':'float','lat':'float'})
과속방지턱.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>과속방지턱</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.068954</td>
      <td>37.130852</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.076305</td>
      <td>37.137946</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.075092</td>
      <td>37.141466</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.071169</td>
      <td>37.143833</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.080466</td>
      <td>37.155872</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 전처리한 과속방지턱 데이터를 pydeck을 이용하여 시각화 하였습니다
과속방지턱맵 = pdk.Layer(
    'ScatterplotLayer',
    과속방지턱,
    get_position='[lon, lat]',
    get_radius='100',
    get_fill_color = '[0, 255, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 과속방지턱맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("과속방지턱맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/과속방지턱맵.PNG'>


```python
# COMPAS에서 제공하는 CCTV 위치 데이터를 불러왔습니다
GetCompasData('SBJ_2012_001', '20', '20.오산시_CCTV설치현황.csv')
CCTV설치현황 = pd.read_csv("20.오산시_CCTV설치현황.csv")
CCTV설치현황
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CCTV 유형코드</th>
      <th>설치위치_도로명주소</th>
      <th>설치위치_위도</th>
      <th>설치위치_경도</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>성호대로55번길 31-2</td>
      <td>37.151836</td>
      <td>127.067541</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>성호대로93번길 45</td>
      <td>37.152812</td>
      <td>127.071702</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>성호대로93번길 26</td>
      <td>37.151167</td>
      <td>127.071677</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>운천로165번길 52-1</td>
      <td>37.157164</td>
      <td>127.075991</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A</td>
      <td>운천로165번길 5</td>
      <td>37.156461</td>
      <td>127.077273</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>562</th>
      <td>E</td>
      <td>성호초</td>
      <td>127.070001</td>
      <td>37.149096</td>
    </tr>
    <tr>
      <th>563</th>
      <td>E</td>
      <td>대원초</td>
      <td>127.072728</td>
      <td>37.131781</td>
    </tr>
    <tr>
      <th>564</th>
      <td>E</td>
      <td>원일초</td>
      <td>127.071237</td>
      <td>37.139445</td>
    </tr>
    <tr>
      <th>565</th>
      <td>E</td>
      <td>운천초</td>
      <td>127.078048</td>
      <td>37.156239</td>
    </tr>
    <tr>
      <th>566</th>
      <td>E</td>
      <td>운산초</td>
      <td>127.076209</td>
      <td>37.152348</td>
    </tr>
  </tbody>
</table>
<p>567 rows × 4 columns</p>
</div>




```python
# CCTV의 위치 데이터 전처리를 해주었습니다
CCTV설치현황 = CCTV설치현황.rename(columns={'설치위치_경도':'lon','설치위치_위도':'lat'})
CCTV설치현황['CCTV'] = 1
CCTV = CCTV설치현황.loc[:,['lon', 'lat', 'CCTV']]
CCTV
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>CCTV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.067541</td>
      <td>37.151836</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.071702</td>
      <td>37.152812</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.071677</td>
      <td>37.151167</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.075991</td>
      <td>37.157164</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.077273</td>
      <td>37.156461</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>562</th>
      <td>37.149096</td>
      <td>127.070001</td>
      <td>1</td>
    </tr>
    <tr>
      <th>563</th>
      <td>37.131781</td>
      <td>127.072728</td>
      <td>1</td>
    </tr>
    <tr>
      <th>564</th>
      <td>37.139445</td>
      <td>127.071237</td>
      <td>1</td>
    </tr>
    <tr>
      <th>565</th>
      <td>37.156239</td>
      <td>127.078048</td>
      <td>1</td>
    </tr>
    <tr>
      <th>566</th>
      <td>37.152348</td>
      <td>127.076209</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>567 rows × 3 columns</p>
</div>




```python
# 전처리한 CCTV 데이터를 pydeck을 이용하여 시각화 하였습니다
CCTV맵 = pdk.Layer(
    'ScatterplotLayer',
    CCTV,
    get_position='[lon, lat]',
    get_radius='50',
    get_fill_color = '[0, 255, 0]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, CCTV맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("CCTV맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/CCTV맵.PNG'>


```python
# COMPAS에서 제공하는 버스정류장 위치 데이터를 불러왔습니다
GetCompasData('SBJ_2012_001', '22', '22.오산시_버스정류장.csv')
버스정류장 = pd.read_csv("22.오산시_버스정류장.csv")
버스정류장
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>정류장 ID</th>
      <th>정류장명</th>
      <th>정류장 위치_경도</th>
      <th>정류장 위치_위도</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>223000095</td>
      <td>오산시티자이1.2단지</td>
      <td>127.091033</td>
      <td>37.149983</td>
    </tr>
    <tr>
      <th>1</th>
      <td>223000124</td>
      <td>재래시장앞</td>
      <td>127.068700</td>
      <td>37.152717</td>
    </tr>
    <tr>
      <th>2</th>
      <td>223000290</td>
      <td>솔매마을</td>
      <td>127.026650</td>
      <td>37.178833</td>
    </tr>
    <tr>
      <th>3</th>
      <td>223000289</td>
      <td>솔매마을</td>
      <td>127.026617</td>
      <td>37.178933</td>
    </tr>
    <tr>
      <th>4</th>
      <td>223000306</td>
      <td>죽미마을입구</td>
      <td>127.046117</td>
      <td>37.178217</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>223000501</td>
      <td>한신대학교</td>
      <td>127.023550</td>
      <td>37.196083</td>
    </tr>
    <tr>
      <th>408</th>
      <td>223000384</td>
      <td>성운시스템</td>
      <td>127.058383</td>
      <td>37.191317</td>
    </tr>
    <tr>
      <th>409</th>
      <td>223000268</td>
      <td>대우푸르지오</td>
      <td>127.082333</td>
      <td>37.136200</td>
    </tr>
    <tr>
      <th>410</th>
      <td>223000468</td>
      <td>오산마을.한국마트</td>
      <td>127.080317</td>
      <td>37.135817</td>
    </tr>
    <tr>
      <th>411</th>
      <td>223509610</td>
      <td>서2동회관앞</td>
      <td>127.040383</td>
      <td>37.152883</td>
    </tr>
  </tbody>
</table>
<p>412 rows × 4 columns</p>
</div>




```python
# 버스 정류장의 위치 데이터 전처리를 하였습니다
버스정류장 = 버스정류장.rename(columns={'정류장 위치_경도':'lon','정류장 위치_위도':'lat'})
버스정류장['버스정류장'] = 1
버스정류장 = 버스정류장.loc[:,['lon', 'lat', '버스정류장']]
버스정류장
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>버스정류장</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.091033</td>
      <td>37.149983</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.068700</td>
      <td>37.152717</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.026650</td>
      <td>37.178833</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.026617</td>
      <td>37.178933</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.046117</td>
      <td>37.178217</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>407</th>
      <td>127.023550</td>
      <td>37.196083</td>
      <td>1</td>
    </tr>
    <tr>
      <th>408</th>
      <td>127.058383</td>
      <td>37.191317</td>
      <td>1</td>
    </tr>
    <tr>
      <th>409</th>
      <td>127.082333</td>
      <td>37.136200</td>
      <td>1</td>
    </tr>
    <tr>
      <th>410</th>
      <td>127.080317</td>
      <td>37.135817</td>
      <td>1</td>
    </tr>
    <tr>
      <th>411</th>
      <td>127.040383</td>
      <td>37.152883</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>412 rows × 3 columns</p>
</div>




```python
# 전처리한 버스정류장 데이터를 pydeck을 이용하여 시각화 하였습니다
버스정류장맵 = pdk.Layer(
    'ScatterplotLayer',
    버스정류장,
    get_position='[lon, lat]',
    get_radius='50',
    get_fill_color = '[0, 0, 255]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 버스정류장맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("버스정류장맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/버스정류장맵.PNG'>

# 2-2. 70x70 격자 안으로 데이터 병합<a id=2-2></a>

## (1) 교통위험도지수 데이터를 격자 안으로 병합<a id=2-2-1></a>

- 격자 데이터 처리 단계에서 이미 70x70격자를 만들었으므로 전처리한 데이터들을 하나씩 집어넣어줄 것입니다
- 보행신호등, 주정차단속, 버스정류장 데이터들은 해결과제 해결에 필요없는 데이터들이므로 데이터 병합에서 제외하였습니다  
- 본 계산은 시간이 오래 걸리므로 얼마나 진행되었는지를 볼 수 있는 tqdm(taqadum)모듈을 사용하였습니다


```python
# 격자데이터 안에 미리 만든 70x70격자를 넣어줍니다
격자데이터 = 격자_조밀한격자.copy()
```


```python
# 격자 데이터에 유동인구 데이터를 삽입 (근방 150미터, 100미터, 50미터 순으로 부여 점수를 다르게 하였습니다)
기준좌표에가중치로삽입240(유동인구)
```

    100%|██████████| 11411/11411 [00:37<00:00, 301.61it/s]
      0%|          | 30/11411 [00:00<00:37, 299.83it/s]

    반경 240m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 11411/11411 [00:37<00:00, 305.50it/s]
      0%|          | 31/11411 [00:00<00:36, 308.33it/s]

    반경 160m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 11411/11411 [00:37<00:00, 305.55it/s]

    반경 80m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 격자 데이터에 유소년인구비율 데이터를 삽입 (근방 150미터, 100미터, 50미터 순으로 부여 점수를 다르게 하였습니다)
기준좌표에가중치로삽입240(유소년인구비율)
```

    100%|██████████| 1776/1776 [00:06<00:00, 292.33it/s]
      2%|▏         | 29/1776 [00:00<00:06, 283.24it/s]

    반경 240m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 1776/1776 [00:05<00:00, 299.44it/s]
      2%|▏         | 30/1776 [00:00<00:05, 292.25it/s]

    반경 160m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 1776/1776 [00:05<00:00, 299.66it/s]

    반경 80m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 격자 데이터에 초등학교 시설 데이터 삽입 (근방 450미터, 300미터, 150미터 순으로 부여 점수를 다르게 하였습니다)
기준좌표에가중치로삽입450(초등학교)
```

    100%|██████████| 24/24 [00:00<00:00, 232.10it/s]
      0%|          | 0/24 [00:00<?, ?it/s]

    반경 450m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 24/24 [00:00<00:00, 257.05it/s]
    100%|██████████| 24/24 [00:00<00:00, 275.41it/s]

    반경 300m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    반경 150m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 격자 데이터에 유치원 시설 데이터 시설 삽입 (근방 450미터, 300미터, 150미터 순으로 부여 점수를 다르게 하였습니다)
기준좌표에가중치로삽입450(유치원)
```

    100%|██████████| 50/50 [00:00<00:00, 258.00it/s]
    100%|██████████| 50/50 [00:00<00:00, 272.59it/s]
      0%|          | 0/50 [00:00<?, ?it/s]

    반경 450m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    반경 300m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 50/50 [00:00<00:00, 269.04it/s]

    반경 150m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 격자 데이터에 어린이집 시설 삽입 (근방 300미터, 200미터, 100미터 순으로 부여 점수를 다르게 하였습니다)
기준좌표에가중치로삽입300(어린이집)
```

    100%|██████████| 257/257 [00:00<00:00, 275.06it/s]
     10%|█         | 26/257 [00:00<00:00, 259.37it/s]

    반경 300m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 257/257 [00:00<00:00, 275.76it/s]
     11%|█▏        | 29/257 [00:00<00:00, 263.78it/s]

    반경 200m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 257/257 [00:00<00:00, 280.54it/s]

    반경 100m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 격자 데이터에 학원및교습소 시설 삽입 (근방 300미터, 200미터, 100미터 순으로 부여 점수를 다르게 하였습니다)
기준좌표에가중치로삽입300(학원및교습소)
```

    100%|██████████| 1680/1680 [00:06<00:00, 254.44it/s]
      2%|▏         | 29/1680 [00:00<00:05, 281.91it/s]

    반경 300m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 1680/1680 [00:05<00:00, 280.25it/s]
      2%|▏         | 29/1680 [00:00<00:05, 282.11it/s]

    반경 200m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 1680/1680 [00:05<00:00, 282.69it/s]

    반경 100m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 격자 데이터에 시설 삽입 (근방 300미터, 200미터, 100미터 순으로 부여 점수를 다르게 하였습니다)
기준좌표에가중치로삽입300(체육시설)
```

    100%|██████████| 145/145 [00:00<00:00, 258.28it/s]
     19%|█▉        | 28/145 [00:00<00:00, 273.32it/s]

    반경 300m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 145/145 [00:00<00:00, 253.12it/s]
     17%|█▋        | 24/145 [00:00<00:00, 239.84it/s]

    반경 200m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 145/145 [00:00<00:00, 267.98it/s]

    반경 100m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 도로에서 80m 떨어진 곳에 교통량, 중앙분리대, 도로신호등 수치를 할당하기 위해 GeoDataFrame형식으로 바꾸어 주었습니다
도로별데이터 = gpd.GeoDataFrame(도로별데이터, geometry = '선폴리곤')
포인트_공간좌표_변환(격자데이터)
격자데이터 = gpd.GeoDataFrame(격자데이터, geometry = '공간좌표')
```


```python
# 80m만큼씩 양옆으로 오프셋시켜 선폴리곤을 만들었었습니다
# 선폴리곤으로 변한 도로데이터 내에 격자포인트가 존재하면 데이터를 넣어주는 형식으로 처리를 하였습니다
# 처리해야 할 계산이 많으므로 시간이 오래 걸립니다 (어차피 한 번만 하면 됩니다)
격자데이터['추정교통량']=0
격자데이터['제한속도']=0
격자데이터['도로신호등']=0
격자데이터['중앙분리대']=0
for i in tqdm(range(len(도로별데이터))):
    위치 = 격자데이터[격자데이터.within(도로별데이터.loc[i,'선폴리곤'])].index
    격자데이터.loc[위치,'추정교통량'] += 도로별데이터.loc[i,'추정교통량']
    격자데이터.loc[위치,'제한속도'] += 도로별데이터.loc[i,'제한속도']
    격자데이터.loc[위치,'도로신호등'] += 도로별데이터.loc[i,'도로신호등']
    격자데이터.loc[위치,'중앙분리대'] += 도로별데이터.loc[i,'중앙분리대']
print("도로 양옆 80m근방의 격자포인트에 데이터를 성공적으로 할당하였습니다")
```

    100%|██████████| 3277/3277 [00:42<00:00, 77.38it/s]

    도로 양옆 80m근방의 격자포인트에 데이터를 성공적으로 할당하였습니다
    

    
    

## (2) 시설물 데이터를 격자 안으로 병합<a id=2-2-2></a>

- 머신러닝 모델에서 학습시키지는 않지만 격자데이터에 미리 넣어두었습니다
- 해결과제2에서 필요한 가중치를 도출해내기 위해 미리 진행하였습니다


```python
기준좌표에가중치로교통안전시설삽입(무인교통단속카메라)
```

    100%|██████████| 112/112 [00:00<00:00, 230.89it/s]
     23%|██▎       | 26/112 [00:00<00:00, 253.92it/s]

    반경 500m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 112/112 [00:00<00:00, 256.66it/s]
     23%|██▎       | 26/112 [00:00<00:00, 253.51it/s]

    반경 300m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 112/112 [00:00<00:00, 247.72it/s]

    반경 100m내의 격자포인트에 가중치 5을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
기준좌표에가중치로교통안전시설삽입(과속방지턱)
```

    100%|██████████| 29/29 [00:00<00:00, 221.54it/s]
      0%|          | 0/29 [00:00<?, ?it/s]

    반경 500m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 29/29 [00:00<00:00, 241.44it/s]
      0%|          | 0/29 [00:00<?, ?it/s]

    반경 300m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 29/29 [00:00<00:00, 241.29it/s]

    반경 100m내의 격자포인트에 가중치 5을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
기준좌표에가중치로교통안전시설삽입(CCTV)
```

    100%|██████████| 567/567 [00:02<00:00, 251.40it/s]
      5%|▍         | 26/567 [00:00<00:02, 250.59it/s]

    반경 500m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 567/567 [00:02<00:00, 252.14it/s]
      4%|▍         | 25/567 [00:00<00:02, 246.91it/s]

    반경 300m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 567/567 [00:02<00:00, 258.04it/s]

    반경 100m내의 격자포인트에 가중치 5을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 마지막으로 타겟 데이터인 어린이교통사고 횟수 데이터를 넣어주었습니다
격자데이터['어린이교통사고횟수'] = 어린이교통사고_격자['어린이교통사고횟수']
기준좌표에가중치로삽입300(어린이교통사고_격자)
# pydeck을 통한 시각화를 위해 다시 DataFrame형식으로 되돌려주었습니다
격자데이터 = pd.DataFrame(격자데이터)
```

    100%|██████████| 9244/9244 [00:35<00:00, 260.21it/s]
      0%|          | 23/9244 [00:00<00:40, 227.23it/s]

    반경 300m내의 격자포인트에 가중치 1을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 9244/9244 [00:35<00:00, 260.66it/s]
      0%|          | 26/9244 [00:00<00:35, 259.31it/s]

    반경 200m내의 격자포인트에 가중치 2을 두어 데이터를 성공적으로 할당하였습니다
    

    100%|██████████| 9244/9244 [00:35<00:00, 262.62it/s]

    반경 100m내의 격자포인트에 가중치 3을 두어 데이터를 성공적으로 할당하였습니다
    

    
    


```python
# 격자데이터의 모든 값들을 정규화시켜주었습니다
# Scikit-learn의 MinMaxScalar를 통하여 정규화를 진행하였습니다
격자데이터 = 격자데이터.drop(['lon', 'lat','공간좌표'], axis='columns')
정규화 = MinMaxScaler()
격자데이터[:] = 정규화.fit_transform(격자데이터[:])
격자데이터 = pd.concat([격자_조밀한격자,격자데이터],axis=1)
격자데이터
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>총유동인구</th>
      <th>유소년인구비율</th>
      <th>초등학교</th>
      <th>유치원</th>
      <th>어린이집</th>
      <th>학원및교습소</th>
      <th>체육시설</th>
      <th>추정교통량</th>
      <th>제한속도</th>
      <th>도로신호등</th>
      <th>중앙분리대</th>
      <th>무인교통단속카메라</th>
      <th>과속방지턱</th>
      <th>CCTV</th>
      <th>어린이교통사고횟수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
      <td>0.006220</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
      <td>0.006304</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
      <td>0.002699</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
      <td>0.001760</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
      <td>0.000700</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9239</th>
      <td>127.103080</td>
      <td>37.143498</td>
      <td>0.000004</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9240</th>
      <td>127.103631</td>
      <td>37.145754</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9241</th>
      <td>127.103636</td>
      <td>37.144852</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9242</th>
      <td>127.103640</td>
      <td>37.143951</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9243</th>
      <td>127.103645</td>
      <td>37.143049</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>9244 rows × 17 columns</p>
</div>




```python
# 어린이보호구역 정비 표준모델에 따른 필요한 데이터들로 모델을 돌리기 위해 데이터프레임 하나를 만들었습니다
격자데이터_모델 = 격자데이터.drop(['중앙분리대','무인교통단속카메라','과속방지턱','CCTV'],axis=1)
격자데이터_모델
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>총유동인구</th>
      <th>유소년인구비율</th>
      <th>초등학교</th>
      <th>유치원</th>
      <th>어린이집</th>
      <th>학원및교습소</th>
      <th>체육시설</th>
      <th>추정교통량</th>
      <th>제한속도</th>
      <th>도로신호등</th>
      <th>어린이교통사고횟수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
      <td>0.006220</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
      <td>0.006304</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
      <td>0.002699</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
      <td>0.001760</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
      <td>0.000700</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9239</th>
      <td>127.103080</td>
      <td>37.143498</td>
      <td>0.000004</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9240</th>
      <td>127.103631</td>
      <td>37.145754</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9241</th>
      <td>127.103636</td>
      <td>37.144852</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9242</th>
      <td>127.103640</td>
      <td>37.143951</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9243</th>
      <td>127.103645</td>
      <td>37.143049</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>9244 rows × 13 columns</p>
</div>




```python
# 해결과제2에서 필요한 데이터들을 위해 데이터프레임을 하나 만들어놓았습니다
격자데이터_시설물 = 격자데이터.loc[:,['lon','lat','중앙분리대','무인교통단속카메라','과속방지턱','CCTV','어린이교통사고횟수']]
격자데이터_시설물
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>중앙분리대</th>
      <th>무인교통단속카메라</th>
      <th>과속방지턱</th>
      <th>CCTV</th>
      <th>어린이교통사고횟수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9239</th>
      <td>127.103080</td>
      <td>37.143498</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9240</th>
      <td>127.103631</td>
      <td>37.145754</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9241</th>
      <td>127.103636</td>
      <td>37.144852</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9242</th>
      <td>127.103640</td>
      <td>37.143951</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9243</th>
      <td>127.103645</td>
      <td>37.143049</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>9244 rows × 7 columns</p>
</div>



# 2-3. 머신러닝을 활용한 위험도 지수 도출<a id=2-3></a>

**각각의 머신러닝을 통한 학습**
- 격자데이터에 추후 필요한 데이터들을 넣어 정규화를 시키는 것까지 완료하였습니다
- 하지만 교통사고 위험지역을 선출할 때에는 교통사고 어린이 보호구역 정비 표준모델에 인용된 데이터들만 필요합니다
- 교통사고 위험지역 도출을 위해 필요한 데이터만 이용하여 머신러닝 작업을 진행하였습니다  

**사용한 머신러닝 회귀모델 7가지**
- Random Forest
- Decision Tree
- MLP (Multi-Layer Perceptron)
- GBM (Gradient Boost Machine)
- LGBM (Light Gradient Boost Machine)
- XGBoost
- Adaboost


```python
# 어린이교통위험에 영향을 주는 아래의 데이터를 이용하여 머신러닝 학습을 진행시킬것입니다
격자데이터_모델
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>총유동인구</th>
      <th>유소년인구비율</th>
      <th>초등학교</th>
      <th>유치원</th>
      <th>어린이집</th>
      <th>학원및교습소</th>
      <th>체육시설</th>
      <th>추정교통량</th>
      <th>제한속도</th>
      <th>도로신호등</th>
      <th>어린이교통사고횟수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
      <td>0.006220</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
      <td>0.006304</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
      <td>0.002699</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
      <td>0.001760</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
      <td>0.000700</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9239</th>
      <td>127.103080</td>
      <td>37.143498</td>
      <td>0.000004</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9240</th>
      <td>127.103631</td>
      <td>37.145754</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9241</th>
      <td>127.103636</td>
      <td>37.144852</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9242</th>
      <td>127.103640</td>
      <td>37.143951</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9243</th>
      <td>127.103645</td>
      <td>37.143049</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>9244 rows × 13 columns</p>
</div>




```python
# 머신러닝 학습을 위해 Train 데이터와 Test 데이터를 구분지었습니다
X = 격자데이터_모델.loc[:,'총유동인구':'도로신호등']
y = 격자데이터_모델.loc[:, "어린이교통사고횟수"]
X_train, X_test, y_train, y_test = train_test_split(X, y,random_state=1, test_size=0.2)

# Train 데이터와 Test 데이터의 개수를 출력해보았습니다
print(len(X_train), len (X_test))
```

    7395 1849
    


```python
##Random forest##


RFmodel = RandomForestRegressor()
RFmodel.fit(X_train, y_train)

y_pred=RFmodel.predict(X_test)

# Kfold
kfold = KFold(n_splits=5, random_state=0, shuffle=True)
scores_fold = cross_val_score(RFmodel, X_train, y_train, cv=kfold, scoring='r2') # model, train, target, cross validation

# Kfold 결과값
print('mean score_kfold \n{:.3f}'.format(scores_fold.mean()))
```

    mean score_kfold 
    0.908
    


```python
##Desicion tree##

DTmodel = DecisionTreeRegressor()
DTmodel.fit(X_train, y_train)

y_pred=RFmodel.predict(X_test)

# Kfold
kfold = KFold(n_splits=5, random_state=0, shuffle=True)
scores_fold = cross_val_score(DTmodel, X_train, y_train, cv=kfold, scoring='r2') # model, train, target, cross validation

# Kfold 결과값
print('mean score_kfold \n{:.3f}'.format(scores_fold.mean()))
```

    mean score_kfold 
    0.803
    


```python
##MLP##

MLPmodel = MLPRegressor(hidden_layer_sizes=(64,64,64),activation="relu" ,random_state=1, max_iter=2000).fit(X_train, y_train)

y_pred=MLPmodel.predict(X_test)

# Kfold
kfold = KFold(n_splits=5, random_state=0, shuffle=True)
scores_fold = cross_val_score(MLPmodel, X_train, y_train, cv=kfold, scoring='r2') # model, train, target, cross validation

# Kfold 결과값
print('mean score_kfold \n{:.3f}'.format(scores_fold.mean()))
```

    mean score_kfold 
    0.834
    


```python
##GBM##

GBMmodel = ensemble.GradientBoostingRegressor()
GBMmodel.fit(X_train, y_train)

y_pred=GBMmodel.predict(X_test)

# Kfold
kfold = KFold(n_splits=5, random_state=0, shuffle=True)
scores_fold = cross_val_score(GBMmodel, X_train, y_train, cv=kfold, scoring='r2') # model, train, target, cross validation

# Kfold 결과값
print('mean score_kfold \n{:.3f}'.format(scores_fold.mean()))
```

    mean score_kfold 
    0.851
    


```python
##LGBM##

LGBMmodel = lgb.LGBMRegressor()
LGBMmodel.fit(X_train, y_train)

y_pred = LGBMmodel.predict(X_test)

# Kfold
kfold = KFold(n_splits=5, random_state=0, shuffle=True)
scores_fold = cross_val_score(LGBMmodel, X_train, y_train, cv=kfold, scoring='r2') # model, train, target, cross validation

# Kfold 결과값
print('mean score_kfold \n{:.3f}'.format(scores_fold.mean()))
```

    mean score_kfold 
    0.907
    


```python
##Adaboost##

ABmodel = AdaBoostRegressor()
ABmodel.fit(X_train, y_train)

y_pred = ABmodel.predict(X_test)

# Kfold
kfold = KFold(n_splits=5, random_state=0, shuffle=True)
scores_fold = cross_val_score(ABmodel, X_train, y_train, cv=kfold, scoring='r2') # model, train, target, cross validation

# Kfold 결과값
print('mean score_kfold \n{:.3f}'.format(scores_fold.mean()))
```

    mean score_kfold 
    0.580
    


```python
##XGboost##

XGBmodel = xgboost.XGBRegressor()
XGBmodel.fit(X_train,y_train)

y_pred = XGBmodel.predict(X_test)

# Kfold
kfold = KFold(n_splits=5, random_state=0, shuffle=True)
scores_fold = cross_val_score(XGBmodel, X_train, y_train, cv=kfold, scoring='r2') # model, train, target, cross validation

# Kfold 결과값
print('mean score_kfold \n{:.3f}'.format(scores_fold.mean()))
```

    mean score_kfold 
    0.909
    

# 2-4. 최적화 모델을 활용한 어린이 교통사고 위험지역 도출<a id=2-4></a>

- 해결과제1은 어린이 보호구역 외 추가로 어린이 교통사고 위험지역을 도출하는 것입니다
- XGBoost 모델이 최적화 모델이라는 결론을 위 단계에서 도출하였습니다
- 정확도 향상과 과적합 방지를 위하여 XGBoost를 튜닝하는 과정을 넣었습니다


```python
##XGBoost의 하이퍼파라미터 튜닝 방법으로 그리드 서치 CV 메소드를 선택하였습니다

#XGBmodel = xgboost.XGBRegressor()
#param_grid={'booster' :['gbtree'],
#                 'silent':[True],
#                 'max_depth':[5,6,8],
#                 'min_child_weight':[1,3,5],
#                 'gamma':[0,1,2,3],
#                 'nthread':[4],
#                 'colsample_bytree':[0.5,0.8],
#                 'colsample_bylevel':[0.9],
#                 'n_estimators':[50],
#                 'objective':['binary:logistic'],
#                 'random_state':[2]}
#
#gcv=GridSearchCV(XGBmodel, param_grid=param_grid, cv=5, scoring='r2', refit=True, return_train_score=True, verbose=0)
#
#gcv.fit(X_train,y_train)
#
#score_df = pd.DataFrame(gcv.cv_results_)
#
#print('final params', gcv.best_params_)   # 최적의 파라미터 값 출력
#print('best score', gcv.best_score_)      # 최고의 점수
#
#estimator = gcv.best_estimator_
#
#y_pred = estimator.predict(X_test)
```


```python
# 튜닝으로 구한 파라마터로 XGBoost 다시 진행

X = 격자데이터_모델.loc[:,'총유동인구':'도로신호등']
y = 격자데이터_모델.loc[:, "어린이교통사고횟수"]
X_train, X_test, y_train, y_test = train_test_split(X, y,random_state=1, test_size=0.2)

XGBmodel = xgboost.XGBRegressor(booster='gbtree',
                 max_depth=8,
                 min_child_weight=1,
                 gamma=0,
                 nthread=4,
                 colsample_bytree=0.8,
                 colsample_bylevel=0.9,
                 n_estimators=50,
                 objective='binary:logistic',
                 random_state=2)
XGBmodel.fit(X_train,y_train)
y_pred = XGBmodel.predict(X)

격자데이터_XGB = 격자데이터.copy()
격자데이터_XGB['어린이교통사고횟수'] = y_pred
격자데이터_XGB
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>총유동인구</th>
      <th>유소년인구비율</th>
      <th>초등학교</th>
      <th>유치원</th>
      <th>어린이집</th>
      <th>학원및교습소</th>
      <th>체육시설</th>
      <th>추정교통량</th>
      <th>제한속도</th>
      <th>도로신호등</th>
      <th>중앙분리대</th>
      <th>무인교통단속카메라</th>
      <th>과속방지턱</th>
      <th>CCTV</th>
      <th>어린이교통사고횟수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
      <td>0.006220</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004426</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
      <td>0.006304</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004426</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
      <td>0.002699</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.003846</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
      <td>0.001760</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004608</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
      <td>0.000700</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002065</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9239</th>
      <td>127.103080</td>
      <td>37.143498</td>
      <td>0.000004</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
    </tr>
    <tr>
      <th>9240</th>
      <td>127.103631</td>
      <td>37.145754</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
    </tr>
    <tr>
      <th>9241</th>
      <td>127.103636</td>
      <td>37.144852</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
    </tr>
    <tr>
      <th>9242</th>
      <td>127.103640</td>
      <td>37.143951</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
    </tr>
    <tr>
      <th>9243</th>
      <td>127.103645</td>
      <td>37.143049</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
    </tr>
  </tbody>
</table>
<p>9244 rows × 17 columns</p>
</div>



# 2-5 어린이 보호구역 외 격자데이터 산출<a id=2-5></a>


```python
# 어린이보호구역에 포함된 격자와 바깥의 격자를 나누어 주어야 합니다
# 그러므로 COMPAS에서 제공한 어린이보호구역 데이터를 불러왔습니다
GetCompasData('SBJ_2012_001', '9', '9.오산시_어린이보호구역.csv')
어린이보호구역 =  pd.read_csv("9.오산시_어린이보호구역.csv")
어린이보호구역 = 어린이보호구역.rename(columns={'보호구역_경도':'lon','보호구역_위도':'lat'})
어린이보호구역 = 어린이보호구역.loc[:,['lon','lat','시설명']]
# 격자데이터가 어린이보호구역 안에 있는지 여부를 알아내기 위해 미리 만들어놓은 함수를 사용하였습니다
격자_어린이보호구역(어린이보호구역)
```


```python
# 어린이보호구역 반경300m를 pydeck을 이용하여 시각화할수있도록 미리 레이어를 추가해놓았습니다
어린이보호구역_맵 =  pd.read_csv("9.오산시_어린이보호구역.csv")
어린이보호구역맵 = pdk.Layer(
    'ScatterplotLayer',
    어린이보호구역_맵,
    get_position='[보호구역_경도, 보호구역_위도]',
    get_radius='300',
    get_fill_color = '[255, 255, 255, 200]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 어린이보호구역맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("어린이보호구역맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/어린이보호구역맵.PNG'>


```python
# 격자데이터_XGB 데이터에 어린이보호구역 내외 여부 변수를 넣어주었습니다
격자데이터_XGB['어린이보호구역'] = 격자_조밀한격자['어린이보호구역']
```


```python
# 어린이보호구역 외에 있는 격자 데이터를 따로 만들었습니다
# 해결과제 1은 어린이보호구역 이외의 어린이위험지역을 도출하는 것이기 때문입니다
격자데이터_어린이보호구역외 = 격자데이터_XGB.drop(
                                격자데이터_XGB[격자데이터_XGB['어린이보호구역']!=0].index).reset_index(drop=True)
격자데이터_어린이보호구역외
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>총유동인구</th>
      <th>유소년인구비율</th>
      <th>초등학교</th>
      <th>유치원</th>
      <th>어린이집</th>
      <th>학원및교습소</th>
      <th>체육시설</th>
      <th>추정교통량</th>
      <th>제한속도</th>
      <th>도로신호등</th>
      <th>중앙분리대</th>
      <th>무인교통단속카메라</th>
      <th>과속방지턱</th>
      <th>CCTV</th>
      <th>어린이교통사고횟수</th>
      <th>어린이보호구역</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
      <td>0.006220</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004426</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
      <td>0.006304</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004426</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
      <td>0.002699</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.003846</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
      <td>0.001760</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004608</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
      <td>0.000700</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002065</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>5292</th>
      <td>127.103080</td>
      <td>37.143498</td>
      <td>0.000004</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5293</th>
      <td>127.103631</td>
      <td>37.145754</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5294</th>
      <td>127.103636</td>
      <td>37.144852</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5295</th>
      <td>127.103640</td>
      <td>37.143951</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5296</th>
      <td>127.103645</td>
      <td>37.143049</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5297 rows × 18 columns</p>
</div>



# 2-6 MCLP를 통한 20개의 어린이 보호구역 외 교통사고 위험지역 최적화<a id=2-6></a>


```python
#MCLP를 통한 20개의 어린이 보호구역 외 교통사고 위험지역 최적화를 진행하였습니다

def generate_candidate_sites(points,M=100):
    '''
    Generate M candidate sites with the convex hull of a point set
    Input:
        points: a Numpy array with shape of (N,2)
        M: the number of candidate sites to generate
    Return:
        sites: a Numpy array with shape of (M,2)
    '''
    hull = ConvexHull(points)
    polygon_points = points[hull.vertices]
    poly = Polygon(polygon_points)
    min_x, min_y, max_x, max_y = poly.bounds
    sites = []
    while len(sites) < M:
        random_point = Point([random.uniform(min_x, max_x),
                             random.uniform(min_y, max_y)])
        if (random_point.within(poly)):
            sites.append(random_point)
    return np.array([(p.x,p.y) for p in sites])

def generate_candidate_sites(df_result_fin,Weight,M=100):
    sites = []
    idx = df_result_fin.sort_values(by = Weight, ascending = False).iloc[1:M].index
    for i in range(len(idx)):
        random_point = Point(np.array(df_result_fin.loc[idx]['리스트좌표'])[i][0],
                             np.array(df_result_fin.loc[idx]['리스트좌표'])[i][1])
        sites.append(random_point)
    return np.array([(p.x,p.y) for p in sites])


from scipy.spatial import distance_matrix
def mclp(points,K,radius,M,df_result_fin,w,Weight):

    """
    Solve maximum covering location problem
    Input:
        points: input points, Numpy array in shape of [N,2]
        K: the number of sites to select
        radius: the radius of circle
        M: the number of candidate sites, which will randomly generated inside
        the ConvexHull wrapped by the polygon
    Return:
        opt_sites: locations K optimal sites, Numpy array in shape of [K,2]
        f: the optimal value of the objective function
    """
    print('----- Configurations -----')
    print('  Number of points %g' % points.shape[0])
    print('  K %g' % K)
    print('  Radius %g' % radius)
    print('  M %g' % M)
    import time
    start = time.time()
    sites = generate_candidate_sites(df_result_fin,Weight,M)
    J = sites.shape[0]
    I = points.shape[0]
    D = distance_matrix(points,sites)
    mask1 = D<=radius
    D[mask1]=1
    D[~mask1]=0

    from mip import Model, xsum, maximize, BINARY

    # 모델 빌드
    m = Model("mclp")
    
    # 변수 추가

    x = [m.add_var(name = "x%d" % j, var_type = BINARY) for j in range(J)]
    y = [m.add_var(name = "y%d" % i, var_type = BINARY) for i in range(I)]


    m.objective = maximize(xsum(w[i]*y[i] for i in range (I)))

    m += xsum(x[j] for j in range(J)) == K
    
    for i in range(I):
        m += xsum(x[j] for j in np.where(D[i]==1)[0]) >= y[i]

    m.max_gap = 0.05
    m.optimize(max_seconds=300)
    
    end = time.time()
    print('----- Output -----')
    print('  Running time : %s seconds' % float(end-start))
    print('  Optimal coverage points: %g' % abs(m.objective_value))

    solution = []
    for i in range(J):
        if x[i].x ==1:
            solution.append(int(x[i].name[1:]))
    opt_sites = sites[solution]
            
    return opt_sites,abs(m.objective_value)
```


```python
# 미리 만들어놓은 함수를 활용하여 리스트좌표를 구하였습니다
위도경도_포인트리스트(격자데이터_어린이보호구역외)
격자데이터_어린이보호구역외
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>총유동인구</th>
      <th>유소년인구비율</th>
      <th>초등학교</th>
      <th>유치원</th>
      <th>어린이집</th>
      <th>학원및교습소</th>
      <th>체육시설</th>
      <th>추정교통량</th>
      <th>제한속도</th>
      <th>도로신호등</th>
      <th>중앙분리대</th>
      <th>무인교통단속카메라</th>
      <th>과속방지턱</th>
      <th>CCTV</th>
      <th>어린이교통사고횟수</th>
      <th>어린이보호구역</th>
      <th>리스트좌표</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>126.994192</td>
      <td>37.177788</td>
      <td>0.006220</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004426</td>
      <td>0</td>
      <td>[126.99419161060558, 37.17778788147216]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>126.994198</td>
      <td>37.176887</td>
      <td>0.006304</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004426</td>
      <td>0</td>
      <td>[126.9941976200589, 37.17688650073755]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>126.994204</td>
      <td>37.175985</td>
      <td>0.002699</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.003846</td>
      <td>0</td>
      <td>[126.99420362924478, 37.17598511986466]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>126.994210</td>
      <td>37.175084</td>
      <td>0.001760</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.004608</td>
      <td>0</td>
      <td>[126.99420963816323, 37.17508373885349]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>126.994216</td>
      <td>37.174182</td>
      <td>0.000700</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.002065</td>
      <td>0</td>
      <td>[126.99421564681425, 37.17418235770403]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>5292</th>
      <td>127.103080</td>
      <td>37.143498</td>
      <td>0.000004</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
      <td>[127.10307976795724, 37.14349828316456]</td>
    </tr>
    <tr>
      <th>5293</th>
      <td>127.103631</td>
      <td>37.145754</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
      <td>[127.10363100736369, 37.145753666724445]</td>
    </tr>
    <tr>
      <th>5294</th>
      <td>127.103636</td>
      <td>37.144852</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
      <td>[127.10363571114542, 37.14485226751358]</td>
    </tr>
    <tr>
      <th>5295</th>
      <td>127.103640</td>
      <td>37.143951</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
      <td>[127.10364041471784, 37.14395086816478]</td>
    </tr>
    <tr>
      <th>5296</th>
      <td>127.103645</td>
      <td>37.143049</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.001412</td>
      <td>0</td>
      <td>[127.10364511808096, 37.14304946867806]</td>
    </tr>
  </tbody>
</table>
<p>5297 rows × 19 columns</p>
</div>




```python
#Natural Break를 통해 하위 값 제외 및 상위 값을 도출하였습니다

격자데이터_어린이보호구역외_Natural = 격자데이터_어린이보호구역외

# 급간을 2구간으로 나눈 후 가장 상위의 값을 1st로 지정하였습니다

격자데이터_어린이보호구역외_Natural['클래스'] = pd.cut(
    격자데이터_어린이보호구역외_Natural ['어린이교통사고횟수'],
    bins=jenkspy.jenks_breaks(격자데이터_어린이보호구역외_Natural['어린이교통사고횟수'], nb_class=2),
    labels=['2nd','1st'],
    include_lowest=True)

교통사고위험지역_클래스1 = 격자데이터_어린이보호구역외_Natural[격자데이터_어린이보호구역외_Natural['클래스'].isin(['1st'])]

# 클래서 1st에 대해서 교통사고 위험지역에 대한 최적의 반경 구하였습니다

df_result_fin = 교통사고위험지역_클래스1

points = []
for i in df_result_fin['리스트좌표'] :
    points.append(i)

w= []
for i in df_result_fin['어린이교통사고횟수'] :
    w.append(i)

교통사고위험지역 = []
for i in [50, 75, 100, 150, 200, 250, 300]:
    radius = radius = (1/88.74/1000)*i
    K = 20
    M = 5000
    opt_sites_org,f = mclp(np.array(points),K,radius,M,df_result_fin,w,'어린이교통사고횟수')
    교통사고위험지역.append([i,f/sum(df_result_fin['어린이교통사고횟수'])])    

교통사고위험지역
```

    ----- Configurations -----
      Number of points 141
      K 20
      Radius 0.000563444
      M 5000
    ----- Output -----
      Running time : 3.2022907733917236 seconds
      Optimal coverage points: 14.5806
    ----- Configurations -----
      Number of points 141
      K 20
      Radius 0.000845166
      M 5000
    ----- Output -----
      Running time : 3.150458574295044 seconds
      Optimal coverage points: 39.6242
    ----- Configurations -----
      Number of points 141
      K 20
      Radius 0.00112689
      M 5000
    ----- Output -----
      Running time : 3.041490077972412 seconds
      Optimal coverage points: 48.725
    ----- Configurations -----
      Number of points 141
      K 20
      Radius 0.00169033
      M 5000
    ----- Output -----
      Running time : 3.477638006210327 seconds
      Optimal coverage points: 52.976
    ----- Configurations -----
      Number of points 141
      K 20
      Radius 0.00225378
      M 5000
    ----- Output -----
      Running time : 2.903071403503418 seconds
      Optimal coverage points: 54.5291
    ----- Configurations -----
      Number of points 141
      K 20
      Radius 0.00281722
      M 5000
    ----- Output -----
      Running time : 2.711764097213745 seconds
      Optimal coverage points: 54.7394
    ----- Configurations -----
      Number of points 141
      K 20
      Radius 0.00338066
      M 5000
    ----- Output -----
      Running time : 2.597843647003174 seconds
      Optimal coverage points: 54.7394
    




    [[50, 0.2663629616719816],
     [75, 0.7238702010187988],
     [100, 0.8901264577707814],
     [150, 0.9677856581598767],
     [200, 0.9961571099366536],
     [250, 1.0],
     [300, 1.0]]




```python
# 반경 별로 교통사고 위험지역을 커버하는 비율을 시각화하였습니다

교통사고위험지역 = pd.DataFrame(교통사고위험지역)
교통사고위험지역.columns = ['covered distance (m)', 'The Ratio of Coverage Points']

교통사고위험지역.plot('covered distance (m)','The Ratio of Coverage Points')
교통사고위험지역
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>covered distance (m)</th>
      <th>The Ratio of Coverage Points</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50</td>
      <td>0.266363</td>
    </tr>
    <tr>
      <th>1</th>
      <td>75</td>
      <td>0.723870</td>
    </tr>
    <tr>
      <th>2</th>
      <td>100</td>
      <td>0.890126</td>
    </tr>
    <tr>
      <th>3</th>
      <td>150</td>
      <td>0.967786</td>
    </tr>
    <tr>
      <th>4</th>
      <td>200</td>
      <td>0.996157</td>
    </tr>
    <tr>
      <th>5</th>
      <td>250</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>300</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>




    
![png](output_149_1.png)
    



```python
# 정부에서 권고하는 교통사고 다발지역 반경에 대한 기준과 위 표에서 뽑은 데이터를 근거하여 반경을 100m로 설정하였습니다
# 클래스 1st로 교통사고 위험지역을 시각화하였습니다

어린이보호구역외_위험도20_X맵 = pdk.Layer(
    'ScatterplotLayer',
    교통사고위험지역_클래스1,
    get_position='[lon, lat]',
    get_radius='77',
    get_fill_color = '[255, 150*어린이교통사고횟수, 51, 150*어린이교통사고횟수]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 어린이보호구역외_위험도20_X맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)

맵.to_html("어린이보호구역외_위험도20_X맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/어린이보호구역외_위험도20_X맵.PNG'>


```python
## 최적 반경 100m로 설정한 뒤 교통사고 위험지역 20개 산출

df_result_fin = 격자데이터_어린이보호구역외

points = []
for i in df_result_fin['리스트좌표'] :
    points.append(i)

w= []
for i in df_result_fin['어린이교통사고횟수'] :
    w.append(i)

radius = radius = (1/88.74/1000)*100
K = 20
M = 5000

opt_sites_org,f = mclp(np.array(points),K,radius,M,df_result_fin,w,'어린이교통사고횟수')

어린이보호구역외_위험도20 = pd.DataFrame(opt_sites_org)
어린이보호구역외_위험도20.columns = ['lon', 'lat']
어린이보호구역외_위험도20
```

    ----- Configurations -----
      Number of points 5297
      K 20
      Radius 0.00112689
      M 5000
    ----- Output -----
      Running time : 18.654192209243774 seconds
      Optimal coverage points: 52.2752
    




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.075465</td>
      <td>37.148360</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.077157</td>
      <td>37.147916</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.071552</td>
      <td>37.143389</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.079474</td>
      <td>37.136206</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.077217</td>
      <td>37.137099</td>
    </tr>
    <tr>
      <th>5</th>
      <td>127.077793</td>
      <td>37.134847</td>
    </tr>
    <tr>
      <th>6</th>
      <td>127.065907</td>
      <td>37.146072</td>
    </tr>
    <tr>
      <th>7</th>
      <td>127.062513</td>
      <td>37.148764</td>
    </tr>
    <tr>
      <th>8</th>
      <td>127.068740</td>
      <td>37.142928</td>
    </tr>
    <tr>
      <th>9</th>
      <td>127.048824</td>
      <td>37.178459</td>
    </tr>
    <tr>
      <th>10</th>
      <td>127.063650</td>
      <td>37.146965</td>
    </tr>
    <tr>
      <th>11</th>
      <td>127.079489</td>
      <td>37.133501</td>
    </tr>
    <tr>
      <th>12</th>
      <td>127.079970</td>
      <td>37.148376</td>
    </tr>
    <tr>
      <th>13</th>
      <td>127.067043</td>
      <td>37.144274</td>
    </tr>
    <tr>
      <th>14</th>
      <td>127.040878</td>
      <td>37.188344</td>
    </tr>
    <tr>
      <th>15</th>
      <td>127.076642</td>
      <td>37.139350</td>
    </tr>
    <tr>
      <th>16</th>
      <td>127.062399</td>
      <td>37.168595</td>
    </tr>
    <tr>
      <th>17</th>
      <td>127.065994</td>
      <td>37.130748</td>
    </tr>
    <tr>
      <th>18</th>
      <td>127.043126</td>
      <td>37.189254</td>
    </tr>
    <tr>
      <th>19</th>
      <td>127.059695</td>
      <td>37.149204</td>
    </tr>
  </tbody>
</table>
</div>



- 해결과제1 제출형식에는 위험지역의 주변 시설물까지 넣어야 합니다
- 그러므로 선정한 20개의 위험지역 주변에 시설물이 존재하면 그 시설물 이름을 넣어주어야 하는 코드를 작성하였습니다
- 시설물이 겹칠 때는 시설물의 중요도에 의거하여 데이터를 넣었습니다


```python
# 먼저 COMPAS에서 제공하는 주변시설 데이터를 가져왔습니다
초등학교여부 = pd.read_csv("10.오산시_학교위치정보.csv")
어린이집유치원여부 = pd.read_csv("13.오산시_어린이집_유치원현황.csv")
체육시설여부 = pd.read_csv("29.오산시_체육시설현황.csv")
학원및교습소여부 = pd.read_csv("30.오산시_학원_및_교습소_현황.csv")
```


```python
# 주변시설물들을 편하게 사용할 수 있게 이전과 다른 형식으로 전처리하여주었습니다
초등학교여부 = 초등학교여부.drop(초등학교여부[초등학교여부['학교구분']!='초등학교'].index).reset_index(drop=True)
초등학교여부 = 초등학교여부.rename(columns = {'학교명':'시설명', '학교위치_경도':'lon', '학교위치_위도':'lat'})
초등학교여부 = 초등학교여부.loc[:,['lon', 'lat','시설명']]
어린이집여부 = 어린이집유치원현황.drop(어린이집유치원현황[어린이집유치원현황['시설구분']!='어린이집'].index).reset_index(drop=True)
어린이집여부 = 어린이집여부.rename(columns = {'시설위치_경도':'lon','시설위치_위도':'lat'})
어린이집여부 = 어린이집여부.loc[:,['lon','lat','시설명']]
유치원여부 = 어린이집유치원현황.drop(어린이집유치원현황[어린이집유치원현황['시설구분']!='유치원'].index).reset_index(drop=True)
유치원여부 = 유치원여부.rename(columns = {'시설위치_경도':'lon','시설위치_위도':'lat'})
유치원여부 = 유치원여부.loc[:,['lon','lat','시설명']]
학원및교습소여부 = 학원및교습소여부.drop(학원및교습소현황[학원및교습소현황['업종구분명']=='평생직업교육학원'].index).reset_index(drop=True)
학원및교습소여부 = 학원및교습소여부.rename(columns = {'교습과정명':'시설명','시설위치_경도':'lon', '시설위치_위도':'lat'})
학원및교습소여부 = 학원및교습소여부.loc[:,['lon', 'lat','시설명']]
체육시설여부 = 체육시설여부.rename(columns = {'시설구분명':'시설명','설치위치_경도':'lon', '설치위치_위도':'lat'})
체육시설여부 = 체육시설여부.loc[:,['lon', 'lat','시설명']]
```


```python
# 좌표 주변에 시설물이 있으면 어떤 시설이 있는지 알려주는 함수를 만들었습니다
def 격자_시설명(데이터):
    for i in range(len(데이터)):               
        위치 = 어린이보호구역외_위험도20[(어린이보호구역외_위험도20['lon'] <= 데이터.loc[i,'lon']+one_meter*300)&
                            (어린이보호구역외_위험도20['lat'] <= 데이터.loc[i,'lat']+one_meter*300)&
                            (데이터.loc[i,'lon']-one_meter*300 <= 어린이보호구역외_위험도20['lon'])&
                            (데이터.loc[i,'lat']-one_meter*300 <= 어린이보호구역외_위험도20['lat'])
                ].index
        어린이보호구역외_위험도20.loc[위치,'시설명'] = 데이터.loc[i,'시설명']
```


```python
# 함수를 적용할 때 중요도가 낮은 순으로 시설을 삽입하도록 순서를 정하였습니다
# 이렇게 순서를 정함으로써 더 중요도있는 시설물이 시설명 컬럼에 들어가도록 할 수 있기 때문입니다 
격자_시설명(체육시설여부)
격자_시설명(학원및교습소여부)
격자_시설명(어린이집여부)
격자_시설명(유치원여부)
격자_시설명(초등학교여부)
어린이보호구역외_위험도20
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>시설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>127.075465</td>
      <td>37.148360</td>
      <td>꿈이노는어린이집</td>
    </tr>
    <tr>
      <th>1</th>
      <td>127.077157</td>
      <td>37.147916</td>
      <td>꿈이노는어린이집</td>
    </tr>
    <tr>
      <th>2</th>
      <td>127.071552</td>
      <td>37.143389</td>
      <td>대림어린이집</td>
    </tr>
    <tr>
      <th>3</th>
      <td>127.079474</td>
      <td>37.136206</td>
      <td>리틀예지어린이집</td>
    </tr>
    <tr>
      <th>4</th>
      <td>127.077217</td>
      <td>37.137099</td>
      <td>리틀예지어린이집</td>
    </tr>
    <tr>
      <th>5</th>
      <td>127.077793</td>
      <td>37.134847</td>
      <td>고현천사어린이집</td>
    </tr>
    <tr>
      <th>6</th>
      <td>127.065907</td>
      <td>37.146072</td>
      <td>전문제과제빵인양성과정</td>
    </tr>
    <tr>
      <th>7</th>
      <td>127.062513</td>
      <td>37.148764</td>
      <td>시립세교행복어린이집</td>
    </tr>
    <tr>
      <th>8</th>
      <td>127.068740</td>
      <td>37.142928</td>
      <td>대림햇살어린이집</td>
    </tr>
    <tr>
      <th>9</th>
      <td>127.048824</td>
      <td>37.178459</td>
      <td>혜아어린이집</td>
    </tr>
    <tr>
      <th>10</th>
      <td>127.063650</td>
      <td>37.146965</td>
      <td>성산초등학교</td>
    </tr>
    <tr>
      <th>11</th>
      <td>127.079489</td>
      <td>37.133501</td>
      <td>사랑뜰어린이집</td>
    </tr>
    <tr>
      <th>12</th>
      <td>127.079970</td>
      <td>37.148376</td>
      <td>꿈나무어린이집</td>
    </tr>
    <tr>
      <th>13</th>
      <td>127.067043</td>
      <td>37.144274</td>
      <td>영어중등</td>
    </tr>
    <tr>
      <th>14</th>
      <td>127.040878</td>
      <td>37.188344</td>
      <td>아가랑어린이집</td>
    </tr>
    <tr>
      <th>15</th>
      <td>127.076642</td>
      <td>37.139350</td>
      <td>리틀예지어린이집</td>
    </tr>
    <tr>
      <th>16</th>
      <td>127.062399</td>
      <td>37.168595</td>
      <td>수학고등3</td>
    </tr>
    <tr>
      <th>17</th>
      <td>127.065994</td>
      <td>37.130748</td>
      <td>해와달어린이집</td>
    </tr>
    <tr>
      <th>18</th>
      <td>127.043126</td>
      <td>37.189254</td>
      <td>신아어린이집</td>
    </tr>
    <tr>
      <th>19</th>
      <td>127.059695</td>
      <td>37.149204</td>
      <td>시립세교행복어린이집</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 해결과제1 제출 형식에 맞게 데이터프레임을 수정하여주었습니다
# 이로써 해결과제1을 완료하였습니다
위험순위 = [i for i in range(1,21)]
해결과제1 = 어린이보호구역외_위험도20.copy()
해결과제1['위험순위']=위험순위
해결과제1['반경범위']='100M'
해결과제1 = 해결과제1.rename(columns={'lon':'x좌표(경도)','lat':'y좌표(위도)'})
해결과제1 = 해결과제1.loc[:,['위험순위','시설명','x좌표(경도)','y좌표(위도)','반경범위']]
해결과제1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>위험순위</th>
      <th>시설명</th>
      <th>x좌표(경도)</th>
      <th>y좌표(위도)</th>
      <th>반경범위</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>꿈이노는어린이집</td>
      <td>127.075465</td>
      <td>37.148360</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>꿈이노는어린이집</td>
      <td>127.077157</td>
      <td>37.147916</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>대림어린이집</td>
      <td>127.071552</td>
      <td>37.143389</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>리틀예지어린이집</td>
      <td>127.079474</td>
      <td>37.136206</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>리틀예지어린이집</td>
      <td>127.077217</td>
      <td>37.137099</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>고현천사어린이집</td>
      <td>127.077793</td>
      <td>37.134847</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>전문제과제빵인양성과정</td>
      <td>127.065907</td>
      <td>37.146072</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>시립세교행복어린이집</td>
      <td>127.062513</td>
      <td>37.148764</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>대림햇살어린이집</td>
      <td>127.068740</td>
      <td>37.142928</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>혜아어린이집</td>
      <td>127.048824</td>
      <td>37.178459</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>성산초등학교</td>
      <td>127.063650</td>
      <td>37.146965</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>사랑뜰어린이집</td>
      <td>127.079489</td>
      <td>37.133501</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>꿈나무어린이집</td>
      <td>127.079970</td>
      <td>37.148376</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>13</th>
      <td>14</td>
      <td>영어중등</td>
      <td>127.067043</td>
      <td>37.144274</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>14</th>
      <td>15</td>
      <td>아가랑어린이집</td>
      <td>127.040878</td>
      <td>37.188344</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>15</th>
      <td>16</td>
      <td>리틀예지어린이집</td>
      <td>127.076642</td>
      <td>37.139350</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>16</th>
      <td>17</td>
      <td>수학고등3</td>
      <td>127.062399</td>
      <td>37.168595</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>17</th>
      <td>18</td>
      <td>해와달어린이집</td>
      <td>127.065994</td>
      <td>37.130748</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>18</th>
      <td>19</td>
      <td>신아어린이집</td>
      <td>127.043126</td>
      <td>37.189254</td>
      <td>100M</td>
    </tr>
    <tr>
      <th>19</th>
      <td>20</td>
      <td>시립세교행복어린이집</td>
      <td>127.059695</td>
      <td>37.149204</td>
      <td>100M</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 최종적으로 도출한 20개의 포인트를 시각화하였습니다
어린이보호구역외_위험도20맵 = pdk.Layer(
    'ScatterplotLayer',
    어린이보호구역외_위험도20,
    get_position='[lon, lat]',
    get_radius='100',
    get_fill_color = '[102, 255, 255]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 어린이보호구역외_위험도20맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("어린이보호구역외_위험도20맵.html", notebook_display=False)
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/어린이보호구역외_위험도20맵.PNG'>


```python
# 최종적으로 도출한 20개의 포인트가 잘 선정되었는지 시각화를 통해 확인해보았습니다
어린이보호구역외_위험도20맵 = pdk.Layer(
    'ScatterplotLayer',
    어린이보호구역외_위험도20,
    get_position='[lon, lat]',
    get_radius='77',
    get_fill_color = '[102, 255, 255]',
    pickable=True,
    auto_highlight=True
)

맵 = pdk.Deck(layers=[읍면동맵, 어린이보호구역외_위험도20_X맵, 어린이보호구역외_위험도20맵],
            mapbox_key = "pk.eyJ1IjoiZWR3YXJkcm9uaWMiLCJhIjoiY2trOW9qa2UyMHpyMjJvbngxMXU2Y3gzbSJ9.3ulI8nY1yimd1b4wk6tfKw",
            initial_view_state=view_state)
맵.to_html("어린이보호구역외_위험도20맵_최종.html", notebook_display=False)
```


```python
격자데이터_어린이보호구역내맵
```

<img src='https://raw.githubusercontent.com/AIdward/predict-traffic-accident/master/src/어린이보호구역외_위험도20맵_최종.PNG'>
